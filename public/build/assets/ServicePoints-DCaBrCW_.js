var fe=Object.defineProperty;var ge=(c,m,d)=>m in c?fe(c,m,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[m]=d;var O=(c,m,d)=>ge(c,typeof m!="symbol"?m+"":m,d);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as p}from"./index-BH53Isel.js";import{c as xe}from"./ReactAppend-DTVVXReZ.js";import{L as je,G as be,M as Ne}from"./esm-hESa1MbP.js";import{B as ve}from"./Base-BFPMzJYQ.js";import{C as ye}from"./CreateReactScript-BoGwggCx.js";import{T as Ce}from"./Table-DitbKwtZ.js";import{I as V}from"./InputFormGroup-D5I6zpZc.js";import{R as N}from"./ReactAppend-D7S498fx.js";import{D as z}from"./DxButton-DV0H-ZcL.js";import{S as we}from"./SwitchFormGroup-CGYpv_4Q.js";import{S as Se}from"./ProductCard-Ap6bpF1Q.js";import{B as Re}from"./BasicRest-9qsOCV42.js";import"./server.browser-Bf4gQIc7.js";import{T as _e}from"./TextareaFormGroup-DVzYJtLM.js";import{M as Be}from"./Modal-CIqmjseY.js";import{S as Ee}from"./SelectFormGroup-YqB1XVb8.js";import{G as ke}from"./Global-ErywZRdd.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./index-rimy3MAc.js";import"./tippy-react.esm-BWiGTO87.js";/* empty css              */import"./Logout-7s5dsuEK.js";import"./main-BvVILmTO.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-C_dOKkRB.js";import"./index.esm-DAJ8Pwbk.js";import"./index-xsH4HHeE.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./index-CMHsc23u.js";class $e extends Re{constructor(){super(...arguments);O(this,"path","admin/service-points")}}const S=new $e,Fe=({})=>{var H,G,L;const c=p.useRef(),m=p.useRef(),d=p.useRef(),R=p.useRef(),_=p.useRef(),B=p.useRef(),E=p.useRef(),[q,T]=p.useState(!1),[o,u]=p.useState([]),[x,v]=p.useState([""]),[j,y]=p.useState([""]),[b,C]=p.useState([{day:"Lun - Vie",hours:"08:00 - 20:00"}]),[g,k]=p.useState({lat:-12.0464,lng:-77.0428}),[h,w]=p.useState("main"),A=s=>{s!=null&&s.id?T(!0):T(!1),d.current.value=(s==null?void 0:s.id)??"",R.current.value=(s==null?void 0:s.type)??"distributor",_.current.value=(s==null?void 0:s.name)??"",B.current.value=(s==null?void 0:s.business_name)??"",E.current.value=(s==null?void 0:s.address)??"";const t=s!=null&&s.phones?s.phones.split(",").map(n=>n.trim()).filter(n=>n):[""];v(t.length>0?t:[""]);const l=s!=null&&s.emails?s.emails.split(",").map(n=>n.trim()).filter(n=>n):[""];y(l.length>0?l:[""]);const a=s!=null&&s.opening_hours?s.opening_hours.split(`
`).map(n=>{const r=n.split(":");return r.length>=2?{day:r[0].trim(),hours:r.slice(1).join(":").trim()}:{day:n.trim(),hours:""}}).filter(n=>n.day):[{day:"Lun - Vie",hours:"08:00 - 20:00"}];if(C(a.length>0?a:[{day:"Lun - Vie",hours:"08:00 - 20:00"}]),s!=null&&s.location){const n=s.location.split(",");if(n.length>=2){const r=parseFloat(n[0].trim()),f=parseFloat(n[1].trim());!isNaN(r)&&!isNaN(f)&&k({lat:r,lng:f})}}else k({lat:-12.0464,lng:-77.0428});const i=(s==null?void 0:s.branches)||[];u(i.map(n=>({name:n.name||"",address:n.address||"",phones:n.phones?n.phones.split(",").map(r=>r.trim()).filter(r=>r):[""],emails:n.emails?n.emails.split(",").map(r=>r.trim()).filter(r=>r):[""],opening_hours:n.opening_hours?n.opening_hours.split(`
`).map(r=>{const f=r.split(":");return f.length>=2?{day:f[0].trim(),hours:f.slice(1).join(":").trim()}:{day:r.trim(),hours:""}}).filter(r=>r.day):[{day:"Lun - Vie",hours:"08:00 - 20:00"}],location:n.location?(()=>{const r=n.location.split(",");if(r.length>=2){const f=parseFloat(r[0].trim()),M=parseFloat(r[1].trim());if(!isNaN(f)&&!isNaN(M))return{lat:f,lng:M}}return{lat:-12.0464,lng:-77.0428}})():{lat:-12.0464,lng:-77.0428}}))),w("main"),$(m.current).modal("show")},U=async s=>{s.preventDefault();const t={id:d.current.value||void 0,type:R.current.value,name:_.current.value,business_name:B.current.value,address:E.current.value,phones:x.filter(a=>a.trim()).join(", "),emails:j.filter(a=>a.trim()).join(", "),opening_hours:b.filter(a=>a.day&&a.hours).map(a=>`${a.day}: ${a.hours}`).join(`
`),location:`${g.lat}, ${g.lng}`,branches:o.length>0?o.map(a=>({name:a.name,address:a.address,phones:a.phones.filter(i=>i.trim()).join(", "),emails:a.emails.filter(i=>i.trim()).join(", "),opening_hours:a.opening_hours.filter(i=>i.day&&i.hours).map(i=>`${i.day}: ${i.hours}`).join(`
`),location:`${a.location.lat}, ${a.location.lng}`})):[],status:1,visible:1};await S.save(t)&&($(c.current).dxDataGrid("instance").refresh(),$(m.current).modal("hide"))},K=async({id:s,value:t})=>{await S.boolean({id:s,field:"visible",value:t})&&$(c.current).dxDataGrid("instance").refresh()},Y=async s=>{const{isConfirmed:t}=await Se.fire({title:"Eliminar punto de servicio",text:"¿Estás seguro de eliminar este punto de servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await S.delete(s)||$(c.current).dxDataGrid("instance").refresh()},J=s=>s==="distributor"?"Distribuidor":"Red de Servicio",Q=s=>s==="distributor"?"badge-soft-primary":"badge-soft-success",W=()=>{v([...x,""])},X=s=>{x.length>1&&v(x.filter((t,l)=>l!==s))},Z=(s,t)=>{const l=[...x];l[s]=t,v(l)},I=()=>{y([...j,""])},ee=s=>{j.length>1&&y(j.filter((t,l)=>l!==s))},se=(s,t)=>{const l=[...j];l[s]=t,y(l)},te=()=>{C([...b,{day:"",hours:""}])},le=s=>{b.length>1&&C(b.filter((t,l)=>l!==s))},P=(s,t,l)=>{const a=[...b];a[s][t]=l,C(a)},ae=s=>{const t=s.latLng.lat(),l=s.latLng.lng();if(h==="main")k({lat:t,lng:l});else{const a=parseInt(h);!isNaN(a)&&o[a]&&F(a,"location",{lat:t,lng:l})}},ie=()=>{u([...o,{name:"",address:"",phones:[""],emails:[""],opening_hours:[{day:"Lun - Vie",hours:"08:00 - 20:00"}],location:{lat:-12.0464,lng:-77.0428}}])},ne=s=>{u(o.filter((t,l)=>l!==s)),h===s.toString()&&w("main")},F=(s,t,l)=>{const a=o.map((i,n)=>n===s?{...i,[t]:l}:i);u(a)},oe=s=>{const t=[...o];t[s].phones.push(""),u(t)},re=(s,t)=>{const l=[...o];l[s].phones.length>1&&(l[s].phones=l[s].phones.filter((a,i)=>i!==t),u(l))},ce=(s,t,l)=>{const a=[...o];a[s].phones[t]=l,u(a)},me=s=>{const t=[...o];t[s].emails.push(""),u(t)},pe=(s,t)=>{const l=[...o];l[s].emails.length>1&&(l[s].emails=l[s].emails.filter((a,i)=>i!==t),u(l))},de=(s,t,l)=>{const a=[...o];a[s].emails[t]=l,u(a)},ue=s=>{const t=[...o];t[s].opening_hours.push({day:"",hours:""}),u(t)},he=(s,t)=>{const l=[...o];l[s].opening_hours.length>1&&(l[s].opening_hours=l[s].opening_hours.filter((a,i)=>i!==t),u(l))},D=(s,t,l,a)=>{const i=[...o];i[s].opening_hours[t][l]=a,u(i)};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{gridRef:c,title:"Puntos de Servicio",rest:S,toolBar:s=>{s.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(c.current).dxDataGrid("instance").refresh()}}),s.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo punto de servicio",hint:"Nuevo punto de servicio",onClick:()=>A()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"type",caption:"Tipo",width:"120px",cellTemplate:(s,{data:t})=>{N(s,e.jsx("span",{className:`badge ${Q(t.type)}`,children:J(t.type)}))}},{dataField:"name",caption:"Información",width:"40%",cellTemplate:(s,{data:t})=>{N(s,e.jsxs("div",{children:[e.jsx("p",{className:"mb-1",children:e.jsx("strong",{children:t.name})}),t.business_name&&e.jsx("p",{className:"mb-1 text-muted small",children:t.business_name}),t.address&&e.jsxs("p",{className:"mb-0 text-muted small",children:[e.jsx("i",{className:"fa fa-map-marker-alt me-1"}),t.address]})]}))}},{dataField:"phones",caption:"Contacto",cellTemplate:(s,{data:t})=>{N(s,e.jsxs("div",{children:[t.phones&&e.jsxs("p",{className:"mb-1 small",children:[e.jsx("i",{className:"fa fa-phone me-1"}),t.phones]}),t.emails&&e.jsxs("p",{className:"mb-0 small",children:[e.jsx("i",{className:"fa fa-envelope me-1"}),t.emails]})]}))}},{dataField:"opening_hours",caption:"Horarios",cellTemplate:(s,{data:t})=>{N(s,t.opening_hours?e.jsx("small",{children:t.opening_hours}):e.jsx("i",{className:"text-muted",children:"No especificado"}))}},{dataField:"branches",caption:"Sucursales",width:"100px",allowFiltering:!1,cellTemplate:(s,{data:t})=>{const l=t.branches?t.branches.length:0;N(s,e.jsxs("span",{className:`badge ${l>0?"badge-soft-info":"badge-soft-secondary"}`,children:[l," sucursal",l!==1?"es":""]}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(s,{data:t})=>{N(s,e.jsx(we,{checked:t.visible,onChange:l=>K({id:t.id,value:l.target.checked})}))}},{caption:"Acciones",width:"120px",cellTemplate:(s,{data:t})=>{s.css("text-overflow","unset"),s.append(z({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>A(t)})),s.append(z({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>Y(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(Be,{modalRef:m,title:q?"Editar punto de servicio":"Agregar punto de servicio",onSubmit:U,size:"xl",children:e.jsxs("div",{className:"row",id:"principal-container",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("input",{ref:d,type:"hidden"}),e.jsxs(Ee,{eRef:R,label:"Tipo",col:"col-12",dropdownParent:"#principal-container",required:!0,children:[e.jsx("option",{value:"distributor",children:"Distribuidor"}),e.jsx("option",{value:"service_network",children:"Red de Servicio"})]}),e.jsx(V,{eRef:_,label:"Nombre",col:"col-12",required:!0}),e.jsx(V,{eRef:B,label:"Razón Social",col:"col-12"}),e.jsx(_e,{eRef:E,label:"Dirección",rows:2,col:"col-12"}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 mt-3",children:[e.jsx("label",{className:"form-label mb-0",children:"Teléfonos"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:W,children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),x.map((s,t)=>e.jsxs("div",{className:"input-group mb-2",children:[e.jsx("input",{type:"text",className:"form-control",value:s,onChange:l=>Z(t,l.target.value),placeholder:`Teléfono ${t+1}`}),x.length>1&&e.jsx("div",{className:"input-group-append",children:e.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>X(t),title:"Eliminar teléfono",children:e.jsx("i",{className:"fa fa-trash"})})})]},t))]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"Emails"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:I,children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),j.map((s,t)=>e.jsxs("div",{className:"input-group mb-2",children:[e.jsx("input",{type:"email",className:"form-control",value:s,onChange:l=>se(t,l.target.value),placeholder:`Email ${t+1}`}),j.length>1&&e.jsx("div",{className:"input-group-append",children:e.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>ee(t),title:"Eliminar email",children:e.jsx("i",{className:"fa fa-trash"})})})]},t))]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"Horarios de Atención"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:te,children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),b.map((s,t)=>e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("input",{type:"text",className:"form-control",value:s.day,onChange:l=>P(t,"day",l.target.value),placeholder:"Ej: Lun - Vie"})}),e.jsx("div",{className:"col-md-6",children:e.jsx("input",{type:"text",className:"form-control",value:s.hours,onChange:l=>P(t,"hours",l.target.value),placeholder:"Ej: 08:00 - 20:00"})}),e.jsx("div",{className:"col-md-2",children:b.length>1&&e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>le(t),title:"Eliminar horario",children:e.jsx("i",{className:"fa fa-trash"})})})]},t))]})}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 mt-4 p-3 bg-light rounded",children:[e.jsx("label",{className:"form-label mb-0 fw-bold",children:"Sucursales"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-soft-primary",onClick:ie,children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar Sucursal"]})]}),o.length===0&&e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"fa fa-info-circle me-2"}),'No hay sucursales agregadas. Haz clic en "Agregar Sucursal" para crear una.']}),o.map((s,t)=>e.jsxs("div",{className:"card mb-4 shadow-sm",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center bg-light",children:[e.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:["Sucursal #",t+1]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-soft-danger",onClick:()=>ne(t),title:"Eliminar sucursal",children:e.jsx("i",{className:"fa fa-trash"})})]}),e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Nombre"}),e.jsx("input",{type:"text",className:"form-control",value:s.name,onChange:l=>F(t,"name",l.target.value),placeholder:"Nombre de la sucursal"})]}),e.jsxs("div",{className:"col-md-12 mt-2",children:[e.jsx("label",{className:"form-label",children:"Dirección"}),e.jsx("input",{type:"text",className:"form-control",value:s.address,onChange:l=>F(t,"address",l.target.value),placeholder:"Dirección completa"})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 mt-3",children:[e.jsx("label",{className:"form-label mb-0",children:"Teléfonos"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>oe(t),children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),s.phones.map((l,a)=>e.jsxs("div",{className:"input-group mb-1",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",value:l,onChange:i=>ce(t,a,i.target.value),placeholder:`Teléfono ${a+1}`}),s.phones.length>1&&e.jsx("div",{className:"input-group-append",children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>re(t,a),title:"Eliminar teléfono",children:e.jsx("i",{className:"fa fa-trash"})})})]},a))]}),e.jsxs("div",{className:"col-md-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"Emails"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>me(t),children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),s.emails.map((l,a)=>e.jsxs("div",{className:"input-group mb-1",children:[e.jsx("input",{type:"email",className:"form-control form-control-sm",value:l,onChange:i=>de(t,a,i.target.value),placeholder:`Email ${a+1}`}),s.emails.length>1&&e.jsx("div",{className:"input-group-append",children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>pe(t,a),title:"Eliminar email",children:e.jsx("i",{className:"fa fa-trash"})})})]},a))]}),e.jsxs("div",{className:"col-md-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"Horarios de Atención"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>ue(t),children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),s.opening_hours.map((l,a)=>e.jsxs("div",{className:"row mb-1",children:[e.jsx("div",{className:"col-5",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:l.day,onChange:i=>D(t,a,"day",i.target.value),placeholder:"Días"})}),e.jsx("div",{className:"col-5",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:l.hours,onChange:i=>D(t,a,"hours",i.target.value),placeholder:"Horario"})}),e.jsx("div",{className:"col-2",children:s.opening_hours.length>1&&e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>he(t,a),title:"Eliminar horario",children:e.jsx("i",{className:"fa fa-trash"})})})]},a))]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Ubicación de la Sucursal"}),e.jsx("div",{className:"mb-2",children:e.jsxs("small",{className:"text-muted",children:["Coordenadas: ",s.location.lat.toFixed(6),", ",s.location.lng.toFixed(6)]})}),e.jsxs("small",{className:"text-muted",children:['Para cambiar la ubicación, selecciona "Sucursal ',t+1,'" en el mapa de la derecha']})]})]})})]},t))]})]}),e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ubicación en el Mapa"}),e.jsx("div",{className:"mb-2",children:e.jsx("small",{className:"text-muted",children:"Haz clic en el mapa para seleccionar la ubicación"})}),e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"nav nav-tabs mb-3 p-2 bg-light rounded",role:"tablist",style:{gap:"8px"},children:[e.jsxs("button",{type:"button",className:`nav-link ${h==="main"?"active":""} px-3 py-2`,onClick:()=>w("main"),style:{marginRight:"8px",borderRadius:"6px"},children:[e.jsx("i",{className:"fa fa-map-marker-alt me-1"}),"Ubicación Principal"]}),o.map((s,t)=>e.jsxs("button",{type:"button",className:`nav-link ${h===t.toString()?"active":""} px-3 py-2`,onClick:()=>w(t.toString()),style:{marginRight:"8px",borderRadius:"6px"},children:[e.jsx("i",{className:"fa fa-building me-1"}),"Sucursal ",t+1]},t))]})}),e.jsx(je,{googleMapsApiKey:ke.GMAPS_API_KEY,preventGoogleFontsLoading:!0,loadingElement:e.jsx("div",{children:"Cargando mapa..."}),children:e.jsx("div",{style:{height:"500px",width:"100%",marginTop:"15px",borderRadius:"8px",overflow:"hidden",border:"1px solid #e3e6f0"},children:e.jsx(be,{mapContainerStyle:{width:"100%",height:"100%"},center:h==="main"?g:((H=o[parseInt(h)])==null?void 0:H.location)||g,zoom:15,onClick:ae,children:e.jsx(Ne,{position:h==="main"?g:((G=o[parseInt(h)])==null?void 0:G.location)||g})})})}),e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-muted",children:["Coordenadas: ",h==="main"?`${g.lat.toFixed(6)}, ${g.lng.toFixed(6)}`:(L=o[parseInt(h)])!=null&&L.location?`${o[parseInt(h)].location.lat.toFixed(6)}, ${o[parseInt(h)].location.lng.toFixed(6)}`:"No seleccionada"]})})]})})})]})})]})};ye((c,m)=>{let d=c._reactRoot;d||(d=xe.createRoot(c),c._reactRoot=d),d.render(e.jsx(ve,{...m,title:"Puntos de Servicio",children:e.jsx(Fe,{...m})}))});
