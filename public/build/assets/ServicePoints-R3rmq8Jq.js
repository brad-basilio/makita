var be=Object.defineProperty;var Ne=(c,p,u)=>p in c?be(c,p,{enumerable:!0,configurable:!0,writable:!0,value:u}):c[p]=u;var q=(c,p,u)=>Ne(c,typeof p!="symbol"?p+"":p,u);import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{r as m}from"./index-BH53Isel.js";import{c as ve}from"./ReactAppend-DTVVXReZ.js";import{L as ye,G as Ce,M as Se}from"./esm-hESa1MbP.js";import{B as Re}from"./Base-BFPMzJYQ.js";import{C as _e}from"./CreateReactScript-BoGwggCx.js";import{T as ke}from"./Table-DitbKwtZ.js";import{I as U}from"./InputFormGroup-D5I6zpZc.js";import{R as N}from"./ReactAppend-D7S498fx.js";import{D as K}from"./DxButton-DV0H-ZcL.js";import{S as B}from"./SwitchFormGroup-CGYpv_4Q.js";import{S as Be}from"./ProductCard-Ap6bpF1Q.js";import{B as we}from"./BasicRest-B3rfI5GY.js";import"./server.browser-Bf4gQIc7.js";import{T as Ee}from"./TextareaFormGroup-DVzYJtLM.js";import{M as $e}from"./Modal-CIqmjseY.js";import{S as Fe}from"./SelectFormGroup-YqB1XVb8.js";import{G as Te}from"./Global-ErywZRdd.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./index-rimy3MAc.js";import"./tippy-react.esm-BWiGTO87.js";/* empty css              */import"./Logout-7s5dsuEK.js";import"./main-BvVILmTO.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-C_dOKkRB.js";import"./index.esm-DAJ8Pwbk.js";import"./index-xsH4HHeE.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./index-CMHsc23u.js";class Pe extends we{constructor(){super(...arguments);q(this,"path","admin/service-points")}}const v=new Pe,De=({})=>{var M,V,O;const c=m.useRef(),p=m.useRef(),u=m.useRef(),w=m.useRef(),E=m.useRef(),F=m.useRef(),T=m.useRef(),y=m.useRef(),C=m.useRef(),[Y,A]=m.useState(!1),[o,d]=m.useState([]),[g,S]=m.useState([""]),[j,R]=m.useState([""]),[x,_]=m.useState([{day:"Lun - Vie",hours:"08:00 - 20:00"}]),[b,P]=m.useState({lat:-12.0464,lng:-77.0428}),[h,k]=m.useState("main"),G=e=>{e!=null&&e.id?A(!0):A(!1),u.current.value=(e==null?void 0:e.id)??"",w.current.value=(e==null?void 0:e.type)??"distributor",E.current.value=(e==null?void 0:e.name)??"",F.current.value=(e==null?void 0:e.business_name)??"",T.current.value=(e==null?void 0:e.address)??"";const t=e!=null&&e.phones?e.phones.split(",").map(i=>i.trim()).filter(i=>i):[""];S(t.length>0?t:[""]);const l=e!=null&&e.emails?e.emails.split(",").map(i=>i.trim()).filter(i=>i):[""];R(l.length>0?l:[""]);const n=e!=null&&e.opening_hours?e.opening_hours.split(`
`).map(i=>{const r=i.split(":");return r.length>=2?{day:r[0].trim(),hours:r.slice(1).join(":").trim()}:{day:i.trim(),hours:""}}).filter(i=>i.day):[{day:"Lun - Vie",hours:"08:00 - 20:00"}];if(_(n.length>0?n:[{day:"Lun - Vie",hours:"08:00 - 20:00"}]),e!=null&&e.location){const i=e.location.split(",");if(i.length>=2){const r=parseFloat(i[0].trim()),f=parseFloat(i[1].trim());!isNaN(r)&&!isNaN(f)&&P({lat:r,lng:f})}}else P({lat:-12.0464,lng:-77.0428});const a=(e==null?void 0:e.branches)||[];d(a.map(i=>({name:i.name||"",address:i.address||"",phones:i.phones?i.phones.split(",").map(r=>r.trim()).filter(r=>r):[""],emails:i.emails?i.emails.split(",").map(r=>r.trim()).filter(r=>r):[""],opening_hours:i.opening_hours?i.opening_hours.split(`
`).map(r=>{const f=r.split(":");return f.length>=2?{day:f[0].trim(),hours:f.slice(1).join(":").trim()}:{day:r.trim(),hours:""}}).filter(r=>r.day):[{day:"Lun - Vie",hours:"08:00 - 20:00"}],location:i.location?(()=>{const r=i.location.split(",");if(r.length>=2){const f=parseFloat(r[0].trim()),z=parseFloat(r[1].trim());if(!isNaN(f)&&!isNaN(z))return{lat:f,lng:z}}return{lat:-12.0464,lng:-77.0428}})():{lat:-12.0464,lng:-77.0428}}))),k("main"),e!=null&&e.status?$(y.current).prop("checked",!0).trigger("change"):$(y.current).prop("checked",!1).trigger("change"),e!=null&&e.visible?$(C.current).prop("checked",!0).trigger("change"):$(C.current).prop("checked",!1).trigger("change"),$(p.current).modal("show")},J=async e=>{e.preventDefault();const t={id:u.current.value||void 0,type:w.current.value,name:E.current.value,business_name:F.current.value,address:T.current.value,phones:g.filter(n=>n.trim()).join(", "),emails:j.filter(n=>n.trim()).join(", "),opening_hours:x.filter(n=>n.day&&n.hours).map(n=>`${n.day}: ${n.hours}`).join(`
`),location:`${b.lat}, ${b.lng}`,branches:o.length>0?o.map(n=>({name:n.name,address:n.address,phones:n.phones.filter(a=>a.trim()).join(", "),emails:n.emails.filter(a=>a.trim()).join(", "),opening_hours:n.opening_hours.filter(a=>a.day&&a.hours).map(a=>`${a.day}: ${a.hours}`).join(`
`),location:`${n.location.lat}, ${n.location.lng}`})):[],status:y.current.checked?1:0,visible:C.current.checked?1:0};await v.save(t)&&($(c.current).dxDataGrid("instance").refresh(),$(p.current).modal("hide"))},Q=async({id:e,value:t})=>{await v.boolean({id:e,field:"visible",value:t})&&$(c.current).dxDataGrid("instance").refresh()},W=async({id:e,value:t})=>{await v.boolean({id:e,field:"status",value:t})&&$(c.current).dxDataGrid("instance").refresh()},X=async e=>{const{isConfirmed:t}=await Be.fire({title:"Eliminar punto de servicio",text:"¿Estás seguro de eliminar este punto de servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await v.delete(e)||$(c.current).dxDataGrid("instance").refresh()},Z=e=>e==="distributor"?"Distribuidor":"Red de Servicio",I=e=>e==="distributor"?"badge-soft-primary":"badge-soft-success",ee=()=>{S([...g,""])},se=e=>{g.length>1&&S(g.filter((t,l)=>l!==e))},te=(e,t)=>{const l=[...g];l[e]=t,S(l)},le=()=>{R([...j,""])},ne=e=>{j.length>1&&R(j.filter((t,l)=>l!==e))},ae=(e,t)=>{const l=[...j];l[e]=t,R(l)},ie=()=>{_([...x,{day:"",hours:""}])},oe=e=>{x.length>1&&_(x.filter((t,l)=>l!==e))},H=(e,t,l)=>{const n=[...x];n[e][t]=l,_(n)},re=e=>{const t=e.latLng.lat(),l=e.latLng.lng();if(h==="main")P({lat:t,lng:l});else{const n=parseInt(h);!isNaN(n)&&o[n]&&D(n,"location",{lat:t,lng:l})}},ce=()=>{d([...o,{name:"",address:"",phones:[""],emails:[""],opening_hours:[{day:"Lun - Vie",hours:"08:00 - 20:00"}],location:{lat:-12.0464,lng:-77.0428}}])},me=e=>{d(o.filter((t,l)=>l!==e)),h===e.toString()&&k("main")},D=(e,t,l)=>{const n=o.map((a,i)=>i===e?{...a,[t]:l}:a);d(n)},pe=e=>{const t=[...o];t[e].phones.push(""),d(t)},ue=(e,t)=>{const l=[...o];l[e].phones.length>1&&(l[e].phones=l[e].phones.filter((n,a)=>a!==t),d(l))},de=(e,t,l)=>{const n=[...o];n[e].phones[t]=l,d(n)},he=e=>{const t=[...o];t[e].emails.push(""),d(t)},fe=(e,t)=>{const l=[...o];l[e].emails.length>1&&(l[e].emails=l[e].emails.filter((n,a)=>a!==t),d(l))},ge=(e,t,l)=>{const n=[...o];n[e].emails[t]=l,d(n)},je=e=>{const t=[...o];t[e].opening_hours.push({day:"",hours:""}),d(t)},xe=(e,t)=>{const l=[...o];l[e].opening_hours.length>1&&(l[e].opening_hours=l[e].opening_hours.filter((n,a)=>a!==t),d(l))},L=(e,t,l,n)=>{const a=[...o];a[e].opening_hours[t][l]=n,d(a)};return s.jsxs(s.Fragment,{children:[s.jsx(ke,{gridRef:c,title:"Puntos de Servicio",rest:v,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(c.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo punto de servicio",hint:"Nuevo punto de servicio",onClick:()=>G()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"type",caption:"Tipo",width:"120px",cellTemplate:(e,{data:t})=>{N(e,s.jsx("span",{className:`badge ${I(t.type)}`,children:Z(t.type)}))}},{dataField:"name",caption:"Información",width:"40%",cellTemplate:(e,{data:t})=>{N(e,s.jsxs("div",{children:[s.jsx("p",{className:"mb-1",children:s.jsx("strong",{children:t.name})}),t.business_name&&s.jsx("p",{className:"mb-1 text-muted small",children:t.business_name}),t.address&&s.jsxs("p",{className:"mb-0 text-muted small",children:[s.jsx("i",{className:"fa fa-map-marker-alt me-1"}),t.address]})]}))}},{dataField:"phones",caption:"Contacto",cellTemplate:(e,{data:t})=>{N(e,s.jsxs("div",{children:[t.phones&&s.jsxs("p",{className:"mb-1 small",children:[s.jsx("i",{className:"fa fa-phone me-1"}),t.phones]}),t.emails&&s.jsxs("p",{className:"mb-0 small",children:[s.jsx("i",{className:"fa fa-envelope me-1"}),t.emails]})]}))}},{dataField:"opening_hours",caption:"Horarios",cellTemplate:(e,{data:t})=>{N(e,t.opening_hours?s.jsx("small",{children:t.opening_hours}):s.jsx("i",{className:"text-muted",children:"No especificado"}))}},{dataField:"branches",caption:"Sucursales",width:"100px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{const l=t.branches?t.branches.length:0;N(e,s.jsxs("span",{className:`badge ${l>0?"badge-soft-info":"badge-soft-secondary"}`,children:[l," sucursal",l!==1?"es":""]}))}},{dataField:"status",caption:"Activo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,s.jsx(B,{checked:t.status,onChange:l=>W({id:t.id,value:l.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,s.jsx(B,{checked:t.visible,onChange:l=>Q({id:t.id,value:l.target.checked})}))}},{caption:"Acciones",width:"120px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(K({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>G(t)})),e.append(K({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>X(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),s.jsx($e,{modalRef:p,title:Y?"Editar punto de servicio":"Agregar punto de servicio",onSubmit:J,size:"lg",children:s.jsxs("div",{className:"row",id:"principal-container",children:[s.jsx("input",{ref:u,type:"hidden"}),s.jsxs(Fe,{eRef:w,label:"Tipo",col:"col-md-6",dropdownParent:"#principal-container",required:!0,children:[s.jsx("option",{value:"distributor",children:"Distribuidor"}),s.jsx("option",{value:"service_network",children:"Red de Servicio"})]}),s.jsx(U,{eRef:E,label:"Nombre",col:"col-md-8",required:!0}),s.jsx(U,{eRef:F,label:"Razón Social",col:"col-md-4"}),s.jsx(Ee,{eRef:T,label:"Dirección",rows:2}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Teléfonos"}),g.map((e,t)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"text",className:"form-control",value:e,onChange:l=>te(t,l.target.value),placeholder:"Ej: +51 999 999 999"}),s.jsxs("div",{className:"input-group-append",children:[g.length>1&&s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>se(t),children:s.jsx("i",{className:"fa fa-trash"})}),t===g.length-1&&s.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:ee,children:s.jsx("i",{className:"fa fa-plus"})})]})]},t))]})}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Emails"}),j.map((e,t)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"email",className:"form-control",value:e,onChange:l=>ae(t,l.target.value),placeholder:"Ej: contacto@empresa.com"}),s.jsxs("div",{className:"input-group-append",children:[j.length>1&&s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>ne(t),children:s.jsx("i",{className:"fa fa-trash"})}),t===j.length-1&&s.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:le,children:s.jsx("i",{className:"fa fa-plus"})})]})]},t))]})}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Horarios de Atención"}),x.map((e,t)=>s.jsxs("div",{className:"row mb-2",children:[s.jsx("div",{className:"col-md-4",children:s.jsx("input",{type:"text",className:"form-control",value:e.day,onChange:l=>H(t,"day",l.target.value),placeholder:"Ej: Lun - Vie"})}),s.jsx("div",{className:"col-md-6",children:s.jsx("input",{type:"text",className:"form-control",value:e.hours,onChange:l=>H(t,"hours",l.target.value),placeholder:"Ej: 08:00 - 20:00"})}),s.jsxs("div",{className:"col-md-2",children:[x.length>1&&s.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>oe(t),children:s.jsx("i",{className:"fa fa-trash"})}),t===x.length-1&&s.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm ml-1",onClick:ie,children:s.jsx("i",{className:"fa fa-plus"})})]})]},t))]})}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Ubicación"}),s.jsx("div",{className:"mb-2",children:s.jsx("small",{className:"text-muted",children:"Haz clic en el mapa para seleccionar la ubicación"})}),s.jsxs("div",{className:"mb-2",children:[s.jsx("button",{type:"button",className:`btn btn-sm mr-2 ${h==="main"?"btn-primary":"btn-outline-primary"}`,onClick:()=>k("main"),children:"Ubicación Principal"}),o.map((e,t)=>s.jsxs("button",{type:"button",className:`btn btn-sm mr-2 ${h===t.toString()?"btn-primary":"btn-outline-primary"}`,onClick:()=>k(t.toString()),children:["Sucursal ",t+1]},t))]}),s.jsx(ye,{googleMapsApiKey:Te.GMAPS_API_KEY,preventGoogleFontsLoading:!0,loadingElement:s.jsx("div",{children:"Cargando mapa..."}),children:s.jsx(Ce,{mapContainerStyle:{width:"100%",height:"300px"},center:h==="main"?b:((M=o[parseInt(h)])==null?void 0:M.location)||b,zoom:15,onClick:re,children:s.jsx(Se,{position:h==="main"?b:((V=o[parseInt(h)])==null?void 0:V.location)||b})})}),s.jsx("div",{className:"mt-2",children:s.jsxs("small",{className:"text-muted",children:["Coordenadas: ",h==="main"?`${b.lat.toFixed(6)}, ${b.lng.toFixed(6)}`:(O=o[parseInt(h)])!=null&&O.location?`${o[parseInt(h)].location.lat.toFixed(6)}, ${o[parseInt(h)].location.lng.toFixed(6)}`:"No seleccionada"]})})]})}),s.jsxs("div",{className:"col-12",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[s.jsx("label",{className:"form-label mb-0",children:"Sucursales"}),s.jsxs("button",{type:"button",className:"btn btn-sm btn-soft-primary",onClick:ce,children:[s.jsx("i",{className:"fa fa-plus me-1"}),"Agregar Sucursal"]})]}),o.length===0&&s.jsxs("div",{className:"alert alert-info",children:[s.jsx("i",{className:"fa fa-info-circle me-2"}),'No hay sucursales agregadas. Haz clic en "Agregar Sucursal" para crear una.']}),o.map((e,t)=>s.jsxs("div",{className:"card mb-3",children:[s.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[s.jsxs("h6",{className:"mb-0",children:["Sucursal #",t+1]}),s.jsx("button",{type:"button",className:"btn btn-sm btn-soft-danger",onClick:()=>me(t),children:s.jsx("i",{className:"fa fa-trash"})})]}),s.jsx("div",{className:"card-body",children:s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-6",children:[s.jsx("label",{className:"form-label",children:"Nombre"}),s.jsx("input",{type:"text",className:"form-control",value:e.name,onChange:l=>D(t,"name",l.target.value),placeholder:"Nombre de la sucursal"})]}),s.jsxs("div",{className:"col-md-6",children:[s.jsx("label",{className:"form-label",children:"Dirección"}),s.jsx("input",{type:"text",className:"form-control",value:e.address,onChange:l=>D(t,"address",l.target.value),placeholder:"Dirección completa"})]}),s.jsxs("div",{className:"col-md-4",children:[s.jsx("label",{className:"form-label",children:"Teléfonos"}),e.phones.map((l,n)=>s.jsxs("div",{className:"input-group mb-1",children:[s.jsx("input",{type:"text",className:"form-control form-control-sm",value:l,onChange:a=>de(t,n,a.target.value),placeholder:"Teléfono"}),s.jsxs("div",{className:"input-group-append",children:[e.phones.length>1&&s.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>ue(t,n),children:s.jsx("i",{className:"fa fa-trash"})}),n===e.phones.length-1&&s.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>pe(t),children:s.jsx("i",{className:"fa fa-plus"})})]})]},n))]}),s.jsxs("div",{className:"col-md-4",children:[s.jsx("label",{className:"form-label",children:"Emails"}),e.emails.map((l,n)=>s.jsxs("div",{className:"input-group mb-1",children:[s.jsx("input",{type:"email",className:"form-control form-control-sm",value:l,onChange:a=>ge(t,n,a.target.value),placeholder:"Email"}),s.jsxs("div",{className:"input-group-append",children:[e.emails.length>1&&s.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>fe(t,n),children:s.jsx("i",{className:"fa fa-trash"})}),n===e.emails.length-1&&s.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>he(t),children:s.jsx("i",{className:"fa fa-plus"})})]})]},n))]}),s.jsxs("div",{className:"col-md-4",children:[s.jsx("label",{className:"form-label",children:"Horarios de Atención"}),e.opening_hours.map((l,n)=>s.jsxs("div",{className:"row mb-1",children:[s.jsx("div",{className:"col-5",children:s.jsx("input",{type:"text",className:"form-control form-control-sm",value:l.day,onChange:a=>L(t,n,"day",a.target.value),placeholder:"Días"})}),s.jsx("div",{className:"col-5",children:s.jsx("input",{type:"text",className:"form-control form-control-sm",value:l.hours,onChange:a=>L(t,n,"hours",a.target.value),placeholder:"Horario"})}),s.jsxs("div",{className:"col-2",children:[e.opening_hours.length>1&&s.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>xe(t,n),children:s.jsx("i",{className:"fa fa-trash"})}),n===e.opening_hours.length-1&&s.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>je(t),children:s.jsx("i",{className:"fa fa-plus"})})]})]},n))]}),s.jsxs("div",{className:"col-12",children:[s.jsx("label",{className:"form-label",children:"Ubicación de la Sucursal"}),s.jsx("div",{className:"mb-2",children:s.jsxs("small",{className:"text-muted",children:["Coordenadas: ",e.location.lat.toFixed(6),", ",e.location.lng.toFixed(6)]})}),s.jsxs("small",{className:"text-muted",children:['Para cambiar la ubicación, selecciona "Sucursal ',t+1,'" en el mapa de arriba']})]})]})})]},t))]}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsx(B,{eRef:y,label:"Estado activo"})}),s.jsx("div",{className:"col-md-6",children:s.jsx(B,{eRef:C,label:"Visible"})})]})})]})})]})};_e((c,p)=>{let u=c._reactRoot;u||(u=ve.createRoot(c),c._reactRoot=u),u.render(s.jsx(Re,{...p,title:"Puntos de Servicio",children:s.jsx(De,{...p})}))});
