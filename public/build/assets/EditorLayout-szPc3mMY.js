import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{a as he,U as ye,R as be,I as re,T as te,S as Q,Z as ve,h as je,g as we,f as Ne,e as Ce,d as Ee,c as Se,C as ke,j as ie,F as $e,b as Pe,i as ne,k as Me,l as ae,m as oe,u as De,D as Re,H as ze}from"./index-CFkglT7d.js";import{r as h}from"./index-BH53Isel.js";import{C as Te}from"./chevron-left-B2s3ZsB7.js";import{E as Ie}from"./eye-CKCH9ORv.js";import{c as le}from"./createLucideIcon-Cy5Ya80P.js";import{S as Ae}from"./star-wPQTHY_n.js";import{H as Le}from"./heart-ChuvJi-4.js";import{S as Ve}from"./sliders-vertical-C5ts4taK.js";import{L as Fe}from"./layers-6oegOx-p.js";import{P as He}from"./palette-DV_Vpyg9.js";import{T as J}from"./trash-2-DK1wnsDn.js";import{U as Be}from"./upload-qgEr5bIl.js";import{P as Oe}from"./plus-Bot15Khs.js";import Xe from"./html2canvas.esm-CBrSDip1.js";import{F as Ye}from"./EditorLayout-iLXaInl0.js";import"./index-yBjzXJbu.js";import"./index-BSWw-p5k.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=le("Blend",[["circle",{cx:"9",cy:"9",r:"7",key:"p2h5vp"}],["circle",{cx:"15",cy:"15",r:"7",key:"19ennj"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=le("Triangle",[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]]);function N({children:e,onClick:a,className:r="",variant:t="default",size:o="default",disabled:n=!1,icon:l=null}){const i="inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",u={default:"bg-purple-600 text-white hover:bg-purple-700",outline:"border border-input hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",secondary:"bg-gray-100 text-gray-800 hover:bg-gray-200"},c={default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md text-sm",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10","icon-sm":"h-8 w-8"};return s.jsxs("button",{className:`${i} ${u[t]} ${c[o]} ${r} gap-2`,onClick:a,disabled:n,children:[l&&s.jsx("span",{className:"w-4 h-4",children:l}),e]})}function We({onExport:e,onPreviewToggle:a,previewMode:r}){return s.jsxs("header",{className:"border-b bg-white p-4 flex items-center justify-between shadow-sm",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(N,{variant:"ghost",size:"sm",children:[s.jsx(Te,{className:"h-5 w-5 mr-1"}),"Regresar"]})}),s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Editor de Fotos Profesional"}),s.jsx("h2",{className:"text-lg text-gray-600",children:"Crea collages y diseños impresionantes"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(N,{variant:"secondary",onClick:a,icon:s.jsx(Ie,{className:"h-4 w-4"}),children:r?"Editar":"Vista previa"}),s.jsx(N,{className:"bg-purple-600 hover:bg-purple-700",icon:s.jsx(he,{className:"h-4 w-4"}),onClick:e,children:"Exportar"})]})]})}function _e({onUndo:e,onRedo:a,onAddImage:r,onAddText:t,onDeleteElement:o,canUndo:n,canRedo:l,hasSelectedElement:i}){return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 flex items-center gap-4",children:[s.jsx(N,{variant:"ghost",size:"icon",onClick:e,disabled:!n,children:s.jsx(ye,{className:"h-5 w-5"})}),s.jsx(N,{variant:"ghost",size:"icon",onClick:a,disabled:!l,children:s.jsx(be,{className:"h-5 w-5"})}),s.jsx("div",{className:"h-6 border-l"}),s.jsx(N,{variant:"ghost",size:"icon",onClick:r,children:s.jsx(re,{className:"h-5 w-5"})}),s.jsx(N,{variant:"ghost",size:"icon",onClick:t,children:s.jsx(te,{className:"h-5 w-5"})}),s.jsx("div",{className:"h-6 border-l"}),s.jsx(N,{variant:"ghost",size:"icon",onClick:o,disabled:!i,children:s.jsx(J,{className:"h-5 w-5"})})]})}const B=[{id:"layout-1",name:"Cuatro fotos",template:"grid-cols-2 grid-rows-2 gap-4",cells:4,maskCategories:[{name:"Básicas",masks:["none","circle","rounded","square","rounded-sm","rounded-lg","rounded-full","rounded-rect"]},{name:"Formas",masks:["heart","star","hexagon","triangle","diamond","badge","speech","burst"]},{name:"Fotográficos",masks:["polaroid","vintage","frame","wave","diagonal","bevel","poster","inner-frame"]},{name:"Creativas",masks:["leaf","cloud","flower","ornate","blob1","blob2","blob3"]}]}];function Ue({selectedLayout:e,onSelect:a}){return s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-2",children:"Layouts"}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:B.map(r=>s.jsxs("div",{className:`border rounded-md p-1 cursor-pointer hover:border-purple-500 ${e===r.id?"border-purple-500 ring-1 ring-purple-200":""}`,onClick:()=>a(r.id),children:[s.jsx("div",{className:`grid ${r.template} gap-1 h-20`,children:Array.from({length:r.cells}).map((t,o)=>s.jsx("div",{className:"bg-gray-100 rounded-sm flex items-center justify-center",children:s.jsx("span",{className:"text-xs text-gray-400",children:o+1})},o))}),s.jsx("p",{className:"text-xs text-center mt-1 truncate",children:r.name})]},r.id))})]})}function Ge({onAddImage:e,onAddText:a}){const r=()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=o=>{o.target.files&&o.target.files[0]&&e(o.target.files[0])},t.click()};return s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-2",children:"Añadir"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(N,{variant:"outline",size:"sm",icon:s.jsx(re,{className:"h-4 w-4"}),onClick:r,children:"Imagen"}),s.jsx(N,{variant:"outline",size:"sm",icon:s.jsx(te,{className:"h-4 w-4"}),onClick:a,children:"Texto"})]})]})}function ce({tabs:e,activeTab:a,onChange:r}){return s.jsx("div",{className:"flex border-b pb-4",children:e.map(t=>s.jsx("button",{className:`flex-1 py-2 text-sm font-medium ${a===t.id?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 hover:text-gray-900"}`,onClick:()=>r(t.id),children:t.label},t.id))})}function T({value:e=[50],min:a=0,max:r=100,step:t=1,onValueChange:o,label:n,unit:l="%"}){const[i,u]=h.useState(e[0]),c=m=>{const d=Number.parseInt(m.target.value);u(d),o&&o([d])};return s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:n}),s.jsxs("span",{className:"text-sm text-gray-500",children:[i,l]})]}),s.jsx("div",{className:"relative flex w-full touch-none select-none items-center",children:s.jsx("input",{type:"range",min:a,max:r,step:t,value:i,onChange:c,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"})})]})}const se=[{id:"none",name:"Sin máscara",class:"",category:"Básicas",icon:"square"},{id:"circle",name:"Círculo",class:"rounded-full",category:"Básicas",icon:"circle"},{id:"rounded",name:"Redondeado",class:"rounded-xl",category:"Básicas",icon:"square-rounded"},{id:"square",name:"Cuadrado",class:"",category:"Básicas",icon:"square"},{id:"heart",name:"Corazón",class:"mask-heart",category:"Formas",icon:"heart"},{id:"star",name:"Estrella",class:"mask-star-2",category:"Formas",icon:"star"},{id:"hexagon",name:"Hexágono",class:"mask-hexagon",category:"Formas",icon:"hexagon"},{id:"triangle",name:"Triángulo",class:"mask-triangle",category:"Formas",icon:"triangle"},{id:"diamond",name:"Diamante",class:"mask-diamond",category:"Formas",icon:"diamond"},{id:"polaroid",name:"Polaroid",class:"mask-polaroid",category:"Fotográficos",icon:"film"},{id:"vintage",name:"Vintage",class:"mask-vintage",category:"Fotográficos",icon:"feather"},{id:"wave",name:"Onda",class:"mask-wave",category:"Fotográficos",icon:"zap"},{id:"leaf",name:"Hoja",class:"mask-leaf",category:"Creativas",icon:"leaf"},{id:"cloud",name:"Nube",class:"mask-cloud",category:"Creativas",icon:"cloud"},{id:"flower",name:"Flor",class:"mask-flower",category:"Creativas",icon:"flower"}],Ze=({name:e,className:a=""})=>{const t={square:Q,circle:ke,heart:Le,star:Ae,hexagon:Se,triangle:qe,diamond:Ee,film:Ce,feather:Ne,cloud:we,flower:je,zap:ve,"square-rounded":Q}[e]||Q;return s.jsx(t,{className:`${a} ${e==="square-rounded"?"rounded-md":""}`})};function Ke({selectedMask:e,onSelect:a,availableMasks:r=[]}){var l;const[t,o]=h.useState("Básicas"),n={};return se.forEach(i=>{n[i.category]||(n[i.category]=[]),(r.includes(i.id)||i.id==="none")&&n[i.category].push(i)}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Máscaras de imagen"}),s.jsx("div",{className:"flex overflow-x-auto pb-2",children:Object.keys(n).map(i=>n[i].length>0&&s.jsx("button",{className:`px-3 py-1 text-sm whitespace-nowrap ${t===i?"border-b-2 border-purple-500 font-medium text-purple-600":"text-gray-600 hover:text-gray-900"}`,onClick:()=>o(i),children:i},i))}),s.jsx("div",{className:"grid grid-cols-3 gap-3",children:(l=n[t])==null?void 0:l.map(i=>s.jsxs("div",{className:`border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors ${e===i.id?"border-purple-500 ring-2 ring-purple-200":""}`,onClick:()=>a(i.id),children:[s.jsx("div",{className:"aspect-square bg-gray-100 rounded-md flex items-center justify-center mb-2",children:s.jsx("div",{className:`w-16 h-16 bg-purple-300 ${i.class} flex items-center justify-center`,children:s.jsx(Ze,{name:i.icon,className:"h-8 w-8 text-purple-600"})})}),s.jsx("p",{className:"text-center text-sm",children:i.name})]},i.id))})]})}const Qe=[{name:"Normal",filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0}},{name:"Vintage",filters:{brightness:90,contrast:110,saturation:80,tint:20,hue:10,blur:1}},{name:"Blanco y negro",filters:{brightness:100,contrast:120,saturation:0,tint:0,hue:0,blur:0}},{name:"Brillante",filters:{brightness:120,contrast:90,saturation:120,tint:0,hue:0,blur:0}},{name:"Oscuro",filters:{brightness:80,contrast:120,saturation:90,tint:10,hue:0,blur:1}},{name:"Sepia",filters:{brightness:90,contrast:100,saturation:50,tint:80,hue:0,blur:0}},{name:"Cálido",filters:{brightness:100,contrast:100,saturation:110,tint:15,hue:20,blur:0}},{name:"Frío",filters:{brightness:100,contrast:100,saturation:110,tint:0,hue:200,blur:0}}],es=[{value:"normal",label:"Normal"},{value:"multiply",label:"Multiplicar"},{value:"screen",label:"Pantalla"},{value:"overlay",label:"Superponer"},{value:"darken",label:"Oscurecer"},{value:"lighten",label:"Aclarar"},{value:"color-dodge",label:"Sobreexposición de color"},{value:"color-burn",label:"Subexposición de color"},{value:"hard-light",label:"Luz fuerte"},{value:"soft-light",label:"Luz suave"},{value:"difference",label:"Diferencia"},{value:"exclusion",label:"Exclusión"},{value:"hue",label:"Tono"},{value:"saturation",label:"Saturación"},{value:"color",label:"Color"},{value:"luminosity",label:"Luminosidad"}];function ss({element:e,filterTab:a,onFilterTabChange:r,onFilterChange:t,availableMasks:o=[]}){var l,i,u,c,m,d,p,f,x,y,j,E;const n=g=>{t({filters:{...e.filters,...g}})};return s.jsxs("div",{className:"space-y-6",children:[s.jsx(ce,{tabs:[{id:"basic",label:"Básicos",icon:s.jsx(Ve,{size:16})},{id:"transform",label:"Transformar",icon:s.jsx(ie,{size:16})},{id:"advanced",label:"Avanzados",icon:s.jsx(Fe,{size:16})}],activeTab:a,onChange:r}),a==="basic"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[s.jsx(He,{className:"h-4 w-4"}),"Filtros predefinidos"]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:Qe.map(g=>s.jsx(N,{variant:"outline",size:"sm",onClick:()=>n(g.filters),children:g.name},g.name))})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Ajustes básicos"}),s.jsx(T,{label:"Brillo",value:[((l=e.filters)==null?void 0:l.brightness)||100],min:0,max:200,onValueChange:g=>t({filters:{...e.filters,brightness:g[0]}})}),s.jsx(T,{label:"Contraste",value:[((i=e.filters)==null?void 0:i.contrast)||100],min:0,max:200,onValueChange:g=>t({filters:{...e.filters,contrast:g[0]}})}),s.jsx(T,{label:"Saturación",value:[((u=e.filters)==null?void 0:u.saturation)||100],min:0,max:200,onValueChange:g=>t({filters:{...e.filters,saturation:g[0]}})}),s.jsx(T,{label:"Tono",value:[((c=e.filters)==null?void 0:c.hue)||0],min:0,max:360,unit:"°",onValueChange:g=>t({filters:{...e.filters,hue:g[0]}})}),s.jsx(T,{label:"Sepia",value:[((m=e.filters)==null?void 0:m.tint)||0],min:0,max:100,onValueChange:g=>t({filters:{...e.filters,tint:g[0]}})}),s.jsx(T,{label:"Desenfoque",value:[((d=e.filters)==null?void 0:d.blur)||0],min:0,max:20,unit:"px",onValueChange:g=>t({filters:{...e.filters,blur:g[0]}})})]})]}),a==="transform"&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium",children:"Transformación"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(N,{variant:(p=e.filters)!=null&&p.flipHorizontal?"secondary":"outline",size:"sm",icon:s.jsx($e,{className:"h-4 w-4"}),onClick:()=>{var g;return t({filters:{...e.filters,flipHorizontal:!((g=e.filters)!=null&&g.flipHorizontal)}})},children:"Voltear H"}),s.jsx(N,{variant:(f=e.filters)!=null&&f.flipVertical?"secondary":"outline",size:"sm",icon:s.jsx(Pe,{className:"h-4 w-4"}),onClick:()=>{var g;return t({filters:{...e.filters,flipVertical:!((g=e.filters)!=null&&g.flipVertical)}})},children:"Voltear V"})]}),s.jsx(T,{label:"Rotación",value:[((x=e.filters)==null?void 0:x.rotate)||0],min:0,max:360,unit:"°",onValueChange:g=>t({filters:{...e.filters,rotate:g[0]}})}),s.jsx(T,{label:"Escala",value:[(((y=e.filters)==null?void 0:y.scale)||1)*100],min:10,max:200,onValueChange:g=>t({filters:{...e.filters,scale:g[0]/100}})})]}),a==="advanced"&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[s.jsx(Je,{className:"h-4 w-4"}),"Ajustes avanzados"]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Modo de mezcla"}),s.jsx("select",{className:"w-full border rounded-md p-2 text-sm",value:((j=e.filters)==null?void 0:j.blendMode)||"normal",onChange:g=>t({filters:{...e.filters,blendMode:g.target.value}}),children:es.map(g=>s.jsx("option",{value:g.value,children:g.label},g.value))})]}),s.jsx(T,{label:"Opacidad",value:[((E=e.filters)==null?void 0:E.opacity)||100],min:0,max:100,onValueChange:g=>t({filters:{...e.filters,opacity:g[0]}})})]}),e.type==="image"&&s.jsx(Ke,{selectedMask:e.mask||"none",onSelect:g=>t({mask:g}),availableMasks:o})]})}function ts({activeTab:e,onTabChange:a,selectedLayout:r,onLayoutChange:t,onAddImage:o,onAddText:n,selectedElement:l,onFilterChange:i,getSelectedElement:u,getCurrentLayout:c}){const[m,d]=h.useState("basic");return s.jsx("aside",{className:"w-64 border-r bg-white p-4 overflow-y-auto shadow-sm",children:s.jsxs("div",{className:"space-y-6",children:[s.jsx(ce,{tabs:[{id:"elements",label:"Elementos"},{id:"filters",label:"Filtros"}],activeTab:e,onChange:a}),e==="elements"?s.jsxs(s.Fragment,{children:[s.jsx(Ue,{selectedLayout:r,onSelect:t}),s.jsx(Ge,{onAddImage:o,onAddText:n})]}):l?s.jsx(ss,{element:u(),filterTab:m,onFilterTabChange:d,onFilterChange:i,availableMasks:c().maskCategories.flatMap(p=>p.masks)}):s.jsx("div",{className:"text-center py-8 text-gray-500",children:"Selecciona un elemento para editar sus filtros"})]})})}function as({page:e,layout:a}){return s.jsx("div",{className:"bg-white p-8 rounded-lg shadow-lg page-preview",children:s.jsx("div",{className:`grid ${a.template} gap-6 aspect-[4/3]`,children:e.cells.map(r=>s.jsx("div",{className:"relative bg-gray-50 rounded-lg overflow-hidden",children:r.elements.map(t=>t.type==="image"?s.jsx(rs,{element:t},t.id):s.jsx(is,{element:t},t.id))},r.id))})})}function rs({element:e}){var r,t,o,n,l,i,u,c,m,d,p,f;const a=imageMasks.find(x=>x.id===e.mask)||imageMasks[0];return s.jsx("div",{className:`absolute ${a.class}`,style:{left:`${e.position.x}px`,top:`${e.position.y}px`,width:"100%",height:"100%"},children:s.jsx("img",{src:e.content,alt:"",className:"w-full h-full object-cover",style:{filter:`
              brightness(${(((r=e.filters)==null?void 0:r.brightness)||100)/100})
              contrast(${(((t=e.filters)==null?void 0:t.contrast)||100)/100})
              saturate(${(((o=e.filters)==null?void 0:o.saturation)||100)/100})
              sepia(${(((n=e.filters)==null?void 0:n.tint)||0)/100})
              hue-rotate(${(((l=e.filters)==null?void 0:l.hue)||0)*3.6}deg)
              blur(${((i=e.filters)==null?void 0:i.blur)||0}px)
            `,transform:`scale(${((u=e.filters)==null?void 0:u.scale)||1}) rotate(${((c=e.filters)==null?void 0:c.rotate)||0}deg) ${(m=e.filters)!=null&&m.flipHorizontal?"scaleX(-1)":""} ${(d=e.filters)!=null&&d.flipVertical?"scaleY(-1)":""}`,mixBlendMode:((p=e.filters)==null?void 0:p.blendMode)||"normal",opacity:(((f=e.filters)==null?void 0:f.opacity)||100)/100}})})}function is({element:e}){var a,r,t,o,n,l,i,u,c,m,d,p;return s.jsx("div",{className:"absolute",style:{left:`${e.position.x}px`,top:`${e.position.y}px`,fontFamily:(a=e.style)==null?void 0:a.fontFamily,fontSize:(r=e.style)==null?void 0:r.fontSize,fontWeight:(t=e.style)==null?void 0:t.fontWeight,fontStyle:(o=e.style)==null?void 0:o.fontStyle,textDecoration:(n=e.style)==null?void 0:n.textDecoration,color:(l=e.style)==null?void 0:l.color,textAlign:(i=e.style)==null?void 0:i.textAlign,backgroundColor:((u=e.style)==null?void 0:u.backgroundColor)||"transparent",padding:((c=e.style)==null?void 0:c.padding)||"8px",borderRadius:((m=e.style)==null?void 0:m.borderRadius)||"0px",border:((d=e.style)==null?void 0:d.border)||"none",opacity:((p=e.style)==null?void 0:p.opacity)||1},children:e.content})}function de({items:e}){const[a,r]=h.useState(null),t=n=>{n.preventDefault(),n.stopPropagation(),r({x:n.clientX,y:n.clientY})},o=()=>{r(null)};return s.jsx("div",{onContextMenu:t,children:a&&s.jsx("div",{className:"fixed bg-white shadow-lg rounded-md z-50 py-1 w-48",style:{left:`${a.x}px`,top:`${a.y}px`},onClick:n=>n.stopPropagation(),children:e.map((n,l)=>s.jsxs("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{n.action(),o()},children:[n.icon,n.label]},l))})})}function ns({element:e,isSelected:a,onSelect:r,onUpdate:t,onDelete:o,availableMasks:n=[]}){var _,X,Y,A,C,P,M,k,R,L,D,z;const[{isDragging:l},i]=ne(()=>({type:"IMAGE_ELEMENT",item:{id:e.id},collect:b=>({isDragging:!!b.isDragging()})})),u=h.useRef(null),[c,m]=h.useState(!1),[d,p]=h.useState({x:0,y:0}),f={filter:`
      brightness(${(((_=e.filters)==null?void 0:_.brightness)||100)/100})
      contrast(${(((X=e.filters)==null?void 0:X.contrast)||100)/100})
      saturate(${(((Y=e.filters)==null?void 0:Y.saturation)||100)/100})
      sepia(${(((A=e.filters)==null?void 0:A.tint)||0)/100})
      hue-rotate(${(((C=e.filters)==null?void 0:C.hue)||0)*3.6}deg)
      blur(${((P=e.filters)==null?void 0:P.blur)||0}px)
    `,transform:`scale(${((M=e.filters)==null?void 0:M.scale)||1}) rotate(${((k=e.filters)==null?void 0:k.rotate)||0}deg) ${(R=e.filters)!=null&&R.flipHorizontal?"scaleX(-1)":""} ${(L=e.filters)!=null&&L.flipVertical?"scaleY(-1)":""}`,mixBlendMode:((D=e.filters)==null?void 0:D.blendMode)||"normal",opacity:(((z=e.filters)==null?void 0:z.opacity)||100)/100},x=se.find(b=>b.id===e.mask)||se[0],y=b=>{a&&(b.stopPropagation(),m(!0),p({x:b.clientX-e.position.x,y:b.clientY-e.position.y}))},j=b=>{if(c&&u.current){const S=u.current.parentElement.getBoundingClientRect(),V=b.clientX-d.x,F=b.clientY-d.y,H=S.width-u.current.offsetWidth,U=S.height-u.current.offsetHeight,G=Math.max(0,Math.min(V,H)),Z=Math.max(0,Math.min(F,U));t({position:{x:G,y:Z}})}},E=()=>{m(!1)},g=()=>{const b=document.createElement("input");b.type="file",b.accept="image/*",b.onchange=S=>{if(S.target.files&&S.target.files[0]){const V=new FileReader;V.onload=F=>{var H;(H=F.target)!=null&&H.result&&t({content:F.target.result})},V.readAsDataURL(S.target.files[0])}},b.click()},q=()=>{const b={...JSON.parse(JSON.stringify(e)),id:`img-${Date.now()}`,position:{x:e.position.x+20,y:e.position.y+20}};t(b,!0)};h.useEffect(()=>(c&&(window.addEventListener("mousemove",j),window.addEventListener("mouseup",E)),()=>{window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",E)}),[c,d]);const O=h.useCallback(b=>{u.current=b,i(b)},[i]),W=[{label:"Reemplazar imagen",icon:s.jsx(Me,{className:"h-4 w-4"}),action:g},{label:"Duplicar",icon:s.jsx(ae,{className:"h-4 w-4"}),action:q},{label:"Reducir opacidad",icon:s.jsx(oe,{className:"h-4 w-4"}),action:()=>{var b;return t({filters:{...e.filters,opacity:Math.max(0,(((b=e.filters)==null?void 0:b.opacity)||100)-10)}})}},{label:"Eliminar",icon:s.jsx(J,{className:"h-4 w-4"}),action:o}];return s.jsxs("div",{ref:O,className:`absolute ${x.class} ${a?"ring-2 ring-purple-500":""} ${l?"opacity-50":"opacity-100"}`,style:{left:`${e.position.x}px`,top:`${e.position.y}px`,width:"100%",height:"100%",cursor:a?"move":"pointer"},onClick:b=>{b.stopPropagation(),r()},onMouseDown:y,children:[s.jsx("div",{className:"w-full h-full overflow-hidden",children:s.jsx("img",{src:e.content,alt:"Imagen cargada",className:"w-full h-full object-cover",style:f})}),a&&s.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[s.jsx("button",{className:"bg-white rounded-full p-1 shadow-md hover:bg-gray-100",onClick:b=>{var S;b.stopPropagation(),t({filters:{...e.filters,rotate:(((S=e.filters)==null?void 0:S.rotate)||0)+90}})},children:s.jsx(ie,{className:"h-4 w-4 text-gray-700"})}),s.jsx("button",{className:"bg-white rounded-full p-1 shadow-md hover:bg-gray-100",onClick:b=>{b.stopPropagation(),o()},children:s.jsx(J,{className:"h-4 w-4 text-gray-700"})})]}),s.jsx(de,{items:W})]})}function os({element:e,isSelected:a,onSelect:r,onUpdate:t,onDelete:o}){var P,M,k,R,L,D,z,b,S,V,F,H,U,G,Z;const[n,l]=h.useState(!1),i=h.useRef(null),u=h.useRef(null),[{isDragging:c},m]=ne(()=>({type:"TEXT_ELEMENT",item:{id:e.id},collect:v=>({isDragging:!!v.isDragging()})})),[d,p]=h.useState(!1),[f,x]=h.useState({x:0,y:0}),y=()=>{l(!0),setTimeout(()=>{i.current&&(i.current.focus(),i.current.select())},0)},j=()=>{l(!1)},E=v=>{t({content:v.target.value})},g=v=>{v.key==="Enter"&&l(!1)},q=v=>{a&&!n&&(v.stopPropagation(),p(!0),x({x:v.clientX-e.position.x,y:v.clientY-e.position.y}))},O=v=>{if(d&&u.current){const $=u.current.parentElement.getBoundingClientRect(),ue=v.clientX-f.x,ge=v.clientY-f.y,pe=$.width-u.current.offsetWidth,fe=$.height-u.current.offsetHeight,me=Math.max(0,Math.min(ue,pe)),xe=Math.max(0,Math.min(ge,fe));t({position:{x:me,y:xe}})}},W=()=>{p(!1)},_=()=>{const v={...JSON.parse(JSON.stringify(e)),id:`text-${Date.now()}`,position:{x:e.position.x+10,y:e.position.y+10}};t(v,!0)};h.useEffect(()=>(d&&(window.addEventListener("mousemove",O),window.addEventListener("mouseup",W)),()=>{window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",W)}),[d,f]);const X=h.useCallback(v=>{u.current=v,m(v)},[m]),Y=(P=e.style)!=null&&P.textShadow?`${e.style.textShadowX||0}px ${e.style.textShadowY||0}px ${e.style.textShadowBlur||0}px ${e.style.textShadowColor||"rgba(0,0,0,0.5)"}`:"none",A={...e.style,position:"absolute",left:`${e.position.x}px`,top:`${e.position.y}px`,cursor:a&&!n?"move":"pointer",textShadow:Y,zIndex:10},C=[{label:"Editar texto",icon:s.jsx(te,{className:"h-4 w-4"}),action:()=>l(!0)},{label:"Duplicar",icon:s.jsx(ae,{className:"h-4 w-4"}),action:_},{label:"Reducir opacidad",icon:s.jsx(oe,{className:"h-4 w-4"}),action:()=>{var v;return t({style:{...e.style,opacity:Math.max(0,(((v=e.style)==null?void 0:v.opacity)||1)-.1)}})}},{label:"Eliminar",icon:s.jsx(J,{className:"h-4 w-4"}),action:o}];return s.jsxs("div",{ref:X,className:`${a?"ring-2 ring-purple-500":""} ${c?"opacity-50":"opacity-100"}`,style:A,onClick:v=>{v.stopPropagation(),r()},onDoubleClick:y,onMouseDown:q,children:[n?s.jsx("input",{ref:i,type:"text",value:e.content,onChange:E,onBlur:j,onKeyDown:g,className:"w-full p-1 border border-gray-300 rounded bg-white",style:{fontFamily:(M=e.style)==null?void 0:M.fontFamily,fontSize:(k=e.style)==null?void 0:k.fontSize,fontWeight:(R=e.style)==null?void 0:R.fontWeight,fontStyle:(L=e.style)==null?void 0:L.fontStyle,textDecoration:(D=e.style)==null?void 0:D.textDecoration,color:(z=e.style)==null?void 0:z.color,textAlign:(b=e.style)==null?void 0:b.textAlign,minWidth:"100px"},autoFocus:!0}):s.jsx("div",{className:"p-2 rounded",style:{backgroundColor:((S=e.style)==null?void 0:S.backgroundColor)||"transparent",padding:((V=e.style)==null?void 0:V.padding)||"8px",borderRadius:((F=e.style)==null?void 0:F.borderRadius)||"0px",border:((H=e.style)==null?void 0:H.border)||"none"},children:e.content||"Editar texto"}),a&&s.jsxs("div",{className:"absolute top-0 right-0 transform translate-y-[-100%] flex gap-1 bg-white rounded-t-md p-1 shadow-sm",children:[s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:v=>{var $;v.stopPropagation(),t({style:{...e.style,fontWeight:(($=e.style)==null?void 0:$.fontWeight)==="bold"?"normal":"bold"}})},children:s.jsx("span",{className:`text-xs ${((U=e.style)==null?void 0:U.fontWeight)==="bold"?"font-bold":""}`,children:"B"})}),s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:v=>{var $;v.stopPropagation(),t({style:{...e.style,fontStyle:(($=e.style)==null?void 0:$.fontStyle)==="italic"?"normal":"italic"}})},children:s.jsx("span",{className:`text-xs ${((G=e.style)==null?void 0:G.fontStyle)==="italic"?"italic":""}`,children:"I"})}),s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:v=>{var $;v.stopPropagation(),t({style:{...e.style,textDecoration:(($=e.style)==null?void 0:$.textDecoration)==="underline"?"none":"underline"}})},children:s.jsx("span",{className:`text-xs ${((Z=e.style)==null?void 0:Z.textDecoration)==="underline"?"underline":""}`,children:"U"})}),s.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:v=>{v.stopPropagation(),o()},children:s.jsx(J,{className:"h-3 w-3 text-gray-700"})})]}),s.jsx(de,{items:C})]})}function ls({id:e,elements:a=[],selectedElement:r,onSelectElement:t,onAddElement:o,availableMasks:n=[]}){const[{isOver:l},i]=De(()=>({accept:["IMAGE_FILE","TEXT_ELEMENT","IMAGE_ELEMENT"],drop:c=>{if(c.files){const m=new FileReader;m.onload=d=>{var p;if((p=d.target)!=null&&p.result){const f={id:`img-${Date.now()}`,type:"image",content:d.target.result,position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"};o(f)}},m.readAsDataURL(c.files[0])}},collect:c=>({isOver:!!c.isOver({shallow:!0})})})),u=()=>{const c=document.createElement("input");c.type="file",c.accept="image/*",c.onchange=m=>{if(m.target.files&&m.target.files[0]){const d=new FileReader;d.onload=p=>{var f;if((f=p.target)!=null&&f.result){const x={id:`img-${Date.now()}`,type:"image",content:p.target.result,position:{x:10,y:10},filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal"},mask:"none"};o(x)}},d.readAsDataURL(m.target.files[0])}},c.click()};return s.jsx("div",{ref:i,className:`relative aspect-square bg-gray-50 rounded-lg overflow-hidden ${l?"ring-2 ring-purple-500 bg-purple-50":""}`,onClick:()=>t(null),children:a.length===0?s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-gray-100 transition-colors",onClick:u,children:[s.jsx(Be,{className:"h-8 w-8 text-gray-400"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Haz clic o arrastra una imagen"})]}):a.map(c=>s.jsx("div",{className:"absolute inset-0",children:c.type==="image"?s.jsx(ns,{element:c,isSelected:r===c.id,onSelect:()=>t(c.id),availableMasks:n}):s.jsx(os,{element:c,isSelected:r===c.id,onSelect:()=>t(c.id)})},c.id))})}function cs({page:e,layout:a,selectedElement:r,selectedCell:t,onSelectElement:o,onSelectCell:n,onAddElement:l,onUpdateElement:i,onDeleteElement:u,onUndo:c,onRedo:m,canUndo:d,canRedo:p,onAddImage:f,onAddText:x}){return s.jsxs("div",{className:"space-y-6",children:[s.jsx(_e,{onUndo:c,onRedo:m,onAddImage:f,onAddText:x,onDeleteElement:()=>{r&&t&&u(t,r)},canUndo:d,canRedo:p,hasSelectedElement:!!r}),s.jsx("div",{className:`bg-white rounded-lg shadow-lg overflow-hidden page-preview ${a.cells<=4?"aspect-[4/3]":""}`,children:s.jsx("div",{className:`grid ${a.template} gap-4 h-full p-4`,children:e.cells.map(y=>s.jsx(ls,{id:y.id,elements:y.elements,selectedElement:t===y.id?r:null,onSelectElement:j=>{o(j),n(y.id)},onAddElement:l,onUpdateElement:(j,E,g)=>{i(y.id,j,E,g)},onDeleteElement:j=>{u(y.id,j)},availableMasks:a.maskCategories.flatMap(j=>j.masks)},y.id))})})]})}function ds({currentPage:e,pages:a,selectedElement:r,selectedCell:t,onSelectElement:o,onSelectCell:n,onAddElement:l,onUpdateElement:i,onDeleteElement:u,getCurrentLayout:c,previewMode:m}){return s.jsx("main",{className:"flex-1 overflow-auto bg-gray-100 p-6",children:s.jsx("div",{className:"max-w-4xl mx-auto",children:m?s.jsx(as,{page:a[e],layout:c()}):s.jsx(cs,{page:a[e],layout:c(),selectedElement:r,selectedCell:t,onSelectElement:o,onSelectCell:n,onAddElement:l,onUpdateElement:i,onDeleteElement:u})})})}function us({pages:e,currentPage:a,onPageChange:r,onAddPage:t,onDuplicatePage:o,onDeletePage:n}){return s.jsx("aside",{className:"w-56 border-l bg-white p-4 overflow-y-auto shadow-sm",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"font-medium",children:"Páginas"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx(N,{variant:"ghost",size:"icon-sm",onClick:o,children:s.jsx(ae,{})}),s.jsx(N,{variant:"ghost",size:"icon-sm",onClick:n,disabled:e.length<=1,children:s.jsx(J,{className:"h-4 w-4"})})]})]}),s.jsxs("div",{className:"grid gap-3",children:[e.map((l,i)=>s.jsx(gs,{page:l,index:i,isActive:a===i,onClick:()=>r(i)},l.id)),s.jsx(N,{variant:"outline",size:"sm",icon:s.jsx(Oe,{className:"h-4 w-4"}),onClick:t,children:"Añadir página"})]})]})})}function gs({page:e,index:a,isActive:r,onClick:t}){return s.jsx("div",{className:`border rounded-md p-2 cursor-pointer hover:border-purple-500 transition-colors ${r?"border-purple-500 ring-2 ring-purple-200":""}`,onClick:t,children:s.jsxs("div",{className:"bg-gray-100 aspect-[4/3] rounded-sm flex items-center justify-center text-xs text-gray-500 relative",children:["Pág. ",a+1,e.cells.some(o=>o.elements.some(n=>n.type==="image"&&n.content))&&s.jsx("div",{className:"absolute inset-0 grid grid-cols-2 grid-rows-2 gap-1 p-1",children:Array.from({length:4}).map((o,n)=>{const l=e.cells[n],i=l==null?void 0:l.elements.find(u=>u.type==="image"&&u.content);return s.jsx("div",{className:"bg-gray-200 rounded-sm overflow-hidden",children:i&&s.jsx("img",{src:i.content,alt:"",className:"w-full h-full object-cover"})},n)})})]})})}function ps(e){const[a,r]=h.useState([JSON.stringify(e)]),[t,o]=h.useState(0),n=m=>{const d=[...a.slice(0,t+1),JSON.stringify(m)];r(d),o(d.length-1)},l=()=>t>0?(o(t-1),JSON.parse(a[t-1])):null,i=()=>t<a.length-1?(o(t+1),JSON.parse(a[t+1])):null,u=t>0,c=t<a.length-1;return{currentState:JSON.parse(a[t]),addToHistory:n,undo:l,redo:i,canUndo:u,canRedo:c}}var K,fs=new Uint8Array(16);function ms(){if(!K&&(K=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!K))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return K(fs)}const xs=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function hs(e){return typeof e=="string"&&xs.test(e)}var w=[];for(var ee=0;ee<256;++ee)w.push((ee+256).toString(16).substr(1));function ys(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(w[e[a+0]]+w[e[a+1]]+w[e[a+2]]+w[e[a+3]]+"-"+w[e[a+4]]+w[e[a+5]]+"-"+w[e[a+6]]+w[e[a+7]]+"-"+w[e[a+8]]+w[e[a+9]]+"-"+w[e[a+10]]+w[e[a+11]]+w[e[a+12]]+w[e[a+13]]+w[e[a+14]]+w[e[a+15]]).toLowerCase();if(!hs(r))throw TypeError("Stringified UUID is invalid");return r}function I(e,a,r){e=e||{};var t=e.random||(e.rng||ms)();return t[6]=t[6]&15|64,t[8]=t[8]&63|128,ys(t)}function bs(e=[]){const a=h.useCallback((d=B[0].id)=>{const p=B.find(f=>f.id===d)||B[0];return{id:I(),layout:p.id,cells:Array.from({length:p.cells}).map(()=>({id:I(),elements:[]}))}},[]),[r,t]=h.useState(e.length?e:[a()]),[o,n]=h.useState(0),l=h.useCallback(d=>{const p=a(d);return t(f=>[...f,p]),n(f=>f+1),p},[a]),i=h.useCallback(d=>{const p=r[d],f={...JSON.parse(JSON.stringify(p)),id:I(),cells:p.cells.map(x=>({...x,id:I(),elements:x.elements.map(y=>({...y,id:I()}))}))};return t(x=>[...x,f]),n(r.length),f},[r]),u=h.useCallback(d=>{r.length<=1||(t(p=>p.filter((f,x)=>x!==d)),n(p=>Math.min(p,r.length-2)))},[r.length]),c=h.useCallback((d,p)=>{const f=B.find(x=>x.id===p);f&&t(x=>x.map((y,j)=>j!==d?y:{...y,layout:p,cells:Array.from({length:f.cells}).map((E,g)=>y.cells[g]||{id:I(),elements:[]})}))},[]),m=h.useCallback(()=>B.find(d=>{var p;return d.id===((p=r[o])==null?void 0:p.layout)})||B[0],[o,r]);return{pages:r,currentPageIndex:o,setCurrentPageIndex:n,addPage:l,duplicatePage:i,deletePage:u,changeLayout:c,currentPage:r[o],getCurrentLayout:m}}function vs(e=[]){const[a,r]=h.useState(e),[t,o]=h.useState(null),[n,l]=h.useState(null),i=(f,x={x:10,y:10})=>{const y=f==="image"?d(x):p(x);return r([...a,y]),o(y.id),y},u=(f,x)=>{r(a.map(y=>y.id===f?{...y,...x}:y))},c=f=>{r(a.filter(x=>x.id!==f)),t===f&&o(null)},m=f=>{const x=a.find(j=>j.id===f);if(!x)return;const y={...JSON.parse(JSON.stringify(x)),id:I(),position:{x:x.position.x+10,y:x.position.y+10}};return r([...a,y]),o(y.id),y},d=f=>({id:I(),type:"image",content:"",position:f,filters:{brightness:100,contrast:100,saturation:100,tint:0,hue:0,blur:0,scale:1,rotate:0,opacity:100,blendMode:"normal",flipHorizontal:!1,flipVertical:!1},mask:"none"}),p=f=>({id:I(),type:"text",content:"Haz clic para editar",position:f,style:{fontSize:"16px",fontFamily:"Arial, sans-serif",color:"#000000",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",backgroundColor:"transparent",padding:"8px",borderRadius:"0px",border:"none",opacity:1,textShadow:"none",textShadowX:0,textShadowY:0,textShadowBlur:0,textShadowColor:"rgba(0,0,0,0.5)"}});return{elements:a,selectedElement:t,selectedCell:n,setSelectedElement:o,setSelectedCell:l,addElement:i,updateElement:u,deleteElement:c,duplicateElement:m}}const js=async(e,a="diseño-pagina")=>{const r=document.getElementById(e);if(!r)return;const t=document.createElement("canvas"),o=r.offsetWidth,n=r.offsetHeight;t.width=o*2,t.height=n*2;const l=t.getContext("2d");l.scale(2,2),l.fillStyle="white",l.fillRect(0,0,o,n);try{(await Xe(r,{scale:2,backgroundColor:null,canvas:t,logging:!1,useCORS:!0})).toBlob(u=>{Ye.saveAs(u,`${a}.png`)})}catch(i){console.error("Error al exportar la página:",i)}};function Hs(){const{pages:e,currentPageIndex:a,setCurrentPageIndex:r,addPage:t,duplicatePage:o,deletePage:n,changeLayout:l,currentPage:i,getCurrentLayout:u}=bs(),{elements:c,selectedElement:m,selectedCell:d,setSelectedElement:p,setSelectedCell:f,addElement:x,deleteElement:y}=vs(),{addToHistory:j}=ps(e),[E,g]=h.useState(!1),[q,O]=h.useState("elements"),[W,_]=h.useState("basic"),X=h.useCallback(()=>{js("page-preview",`diseño-pagina-${a+1}`)},[a]),Y=h.useCallback(()=>{g(C=>!C)},[]),A=h.useCallback((C,P,M)=>{const k=e.map((R,L)=>L!==a?R:{...R,cells:R.cells.map(D=>D.id!==C?D:{...D,elements:D.elements.map(z=>z.id!==P?z:{...z,...M})})});setPages(k),j(k)},[e,a,j]);return s.jsx(Re,{backend:ze,children:s.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 mx-auto max-w-7xl",children:[s.jsx(We,{onExport:X,onPreviewToggle:Y,previewMode:E}),s.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[s.jsx(ts,{activeTab:q,onTabChange:O,selectedLayout:i.layout,onLayoutChange:C=>{l(a,C),j(e)},onAddImage:C=>{const P=new FileReader;P.onload=M=>{var k;(k=M.target)!=null&&k.result&&x("image",{content:M.target.result})},P.readAsDataURL(C)},onAddText:()=>{x("text")},selectedElement:m,onFilterChange:A,getSelectedElement:()=>c.find(C=>C.id===m),getCurrentLayout:u}),s.jsx(ds,{currentPage:a,pages:e,selectedElement:m,selectedCell:d,onSelectElement:p,onSelectCell:f,onAddElement:x,onUpdateElement:A,onDeleteElement:y,getCurrentLayout:u,previewMode:E}),s.jsx(us,{pages:e,currentPage:a,onPageChange:r,onAddPage:()=>{t(),j(e)},onDuplicatePage:()=>{o(a),j(e)},onDeletePage:()=>{n(a),j(e)}})]})]})})}export{Hs as default};
