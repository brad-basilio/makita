var ne=Object.defineProperty;var ce=(c,t,l)=>t in c?ne(c,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[t]=l;var B=(c,t,l)=>ce(c,typeof t!="symbol"?t+"":t,l);import{j as s}from"./AboutSimple-Cf8x2fCZ.js";import{r as i}from"./index-BH53Isel.js";import{c as le}from"./ReactAppend-DTVVXReZ.js";import{s as o}from"./server.browser-Bf4gQIc7.js";import{D as oe}from"./DeliveryPricesRest-fZHni7Xz.js";import"./main-BvVILmTO.js";import{B as ae}from"./BasicRest-CD3GL1x9.js";import{C as pe}from"./CreateReactScript-BoGwggCx.js";import{S as ue}from"./ProductCard-Ap6bpF1Q.js";import{B as me}from"./Base-C_-9HyC1.js";import{D as G}from"./DxButton-CsjWvhyj.js";import{M as I}from"./Modal-CIqmjseY.js";import{T as J}from"./Table-DitbKwtZ.js";import{I as x}from"./InputFormGroup-D5I6zpZc.js";import{S as fe}from"./SelectFormGroup-YqB1XVb8.js";import{S as V}from"./SwitchFormGroup-CGYpv_4Q.js";import{T as de}from"./TextareaFormGroup-DVzYJtLM.js";import{N as A}from"./Number2Currency-e57Tgsuk.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./index-CMHsc23u.js";import"./index-rimy3MAc.js";import"./index.esm-DAJ8Pwbk.js";import"./index-xsH4HHeE.js";import"./Global-ErywZRdd.js";/* empty css               *//* empty css              */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./tippy-react.esm-BWiGTO87.js";import"./Logout-7s5dsuEK.js";import"./MenuItemContainer-C_dOKkRB.js";class he extends ae{constructor(){super(...arguments);B(this,"path","admin/types_delivery");B(this,"hasFiles",!0)}}const b=new oe,K=new he,xe=({ubigeo:c=[]})=>{const t=i.useRef(),l=i.useRef(),j=i.useRef(),z=i.useRef(),R=i.useRef(),w=i.useRef(),g=i.useRef(),C=i.useRef(),N=i.useRef(),m=i.useRef(),f=i.useRef(),T=i.useRef(),E=i.useRef(),[q,M]=i.useState(!1),[L,P]=i.useState(!1),[ge,Q]=i.useState(!1),[d,D]=i.useState(!1),[v,S]=i.useState(!1),[O,p]=i.useState(""),U=e=>{console.log(e),e!=null&&e.id?M(!0):M(!1),w.current.value=(e==null?void 0:e.id)??"",$(g.current).val((e==null?void 0:e.ubigeo)??null).trigger("change"),Q((e==null?void 0:e.price)===null),m.current&&(m.current.checked=(e==null?void 0:e.is_free)??!1,D((e==null?void 0:e.is_free)??!1),e!=null&&e.is_free&&p("El envío gratis tiene costo 0. Puede agregar un costo adicional para delivery express.")),f.current&&(f.current.checked=(e==null?void 0:e.is_agency)??!1,S((e==null?void 0:e.is_agency)??!1),e!=null&&e.is_agency&&p("Este es un envío que se realizará por empresas de envío como Shalom, Olva Currier u otros, el cliente realizara el pago en destino.")),C.current.value=(e==null?void 0:e.price)??0,T.current.value=(e==null?void 0:e.express_price)??0,E.current.value=(e==null?void 0:e.agency_price)??0,N.current.value=(e==null?void 0:e.description)??"",$(j.current).modal("show")},W=async e=>{e.preventDefault();const r=c.find(h=>h.reniec==g.current.value),n={id:w.current.value||void 0,name:`${r.distrito}, ${r.departamento}`.toTitleCase(),price:d?null:C.current.value,is_free:m.current.checked,is_agency:f.current.checked,express_price:T.current.value,agency_price:E.current.value,description:N.current.value,ubigeo:g.current.value};await b.save(n)&&($(t.current).dxDataGrid("instance").refresh(),$(j.current).modal("hide"))},k=i.useRef(),_=i.useRef(),F=i.useRef(),[a,u]=i.useState([{value:""}]),X=()=>{u([...a,{value:""}])},Y=(e,r)=>{const n=[...a];n[e].value=r,u(n)},Z=e=>{if(a.length<=1)return;const r=a.filter((n,y)=>y!==e);u(r)},ee=()=>{$(z.current).modal("show")},se=e=>{e!=null&&e.id?P(!0):P(!1),k.current.value=(e==null?void 0:e.id)??"",_.current.value=(e==null?void 0:e.name)??"",F.current.value=(e==null?void 0:e.description)??"",e!=null&&e.characteristics&&e.characteristics.length>0?u(e.characteristics.map(r=>({value:r}))):u([{value:""}]),$(R.current).modal("show")},re=async e=>{e.preventDefault();const r=new FormData;r.append("name",_.current.value),r.append("description",F.current.value),L&&r.append("id",k.current.value);const n=a.map(h=>h.value.trim()).filter(h=>h.length>0);r.append("characteristics",JSON.stringify(n)),await K.save(r)&&($(l.current).dxDataGrid("instance").refresh(),$(R.current).modal("hide"),u([{value:""}]))},ie=async e=>{const{isConfirmed:r}=await ue.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!r||!await b.delete(e)||$(t.current).dxDataGrid("instance").refresh()},H=e=>$(o.renderToString(s.jsxs("span",{children:[s.jsx("span",{className:"d-block w-100 text-truncate",children:e.text.replace(e.id,"")}),s.jsxs("small",{className:"d-block",children:["Ubigeo: ",e.id]})]}))),te=async e=>{const r=e.target.files[0];if(!r)return;e.target.value=null;const n=new FormData;n.append("excel",r),await b.upload(n)&&$(t.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx("input",{id:"file-input",type:"file",accept:".xlsx, .xls",style:{display:"none"},onChange:te}),s.jsx(J,{gridRef:t,title:"Costos de envío",rest:b,exportable:!0,exportableName:"delivery.prices",toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",hint:"Cargar archivo Excel",onClick:()=>document.getElementById("file-input").click()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(t.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>U()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",text:"Actualizar datos de Delivery",hint:"Actualizar datos de Delivery",onClick:()=>ee()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"ubigeo",caption:"Ubigeo (RENIEC)",width:"150px"},{dataField:"name",caption:"Envío a",width:"200px",allowExporting:!1},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:r})=>{e.html(r.description||'<i class="text-muted">- Sin descripción -</i>')}},{dataField:"is_free",dataType:"number",caption:"Tipo Envio",cellTemplate:(e,{data:r})=>{r.is_free?e.html(o.renderToString(s.jsxs("div",{className:"d-flex gap-2",children:[s.jsx("span",{className:"text-muted font-italic",children:"Delivery Gratis"}),s.jsx("span",{className:"text-muted font-italic",children:"Delivery Express"})]}))):r.is_agency?e.html(o.renderToString(s.jsx("span",{className:"text-muted font-italic",children:"Recojo en agencia"}))):e.html(o.renderToString(s.jsx("span",{className:"text-muted font-italic",children:"Delivery"})))}},{dataField:"price",caption:"Precio",dataType:"number",width:"150px",cellTemplate:(e,{data:r})=>{r.is_free?e.html(o.renderToString(s.jsxs("div",{className:"row",children:[" ",s.jsx("span",{className:"text-muted font-italic",children:"Delivery Gratis"}),s.jsxs("span",{className:"text-muted",children:["Express:"," ",s.jsxs("span",{className:"font-monospace text-reset",children:["S/."," ",A(r.express_price)]})]})]}))):r.price>0?e.html(o.renderToString(s.jsxs("span",{children:["S/. ",A(r.price)]}))):r.is_agency>0?e.html(o.renderToString(s.jsxs("span",{children:["S/. ",A(r.agency_price)]}))):e.text("Gratis")}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(G({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>U(r)})),e.append(G({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>ie(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),s.jsxs(I,{modalRef:j,title:q?"Editar Costo de envío":"Agregar Costo de envío",onSubmit:W,size:"md",children:[s.jsx("input",{ref:w,type:"hidden"}),s.jsxs("div",{id:"form-container",className:"row",children:[s.jsx(fe,{eRef:g,label:"Distrito/Ubigeo",templateResult:H,templateSelection:H,dropdownParent:"#form-container",required:!0,children:c.map((e,r)=>s.jsxs("option",{value:e.reniec,children:[e.reniec," ",e.distrito," ",e.provincia," ",e.departamento]},r))}),s.jsxs("div",{className:"col-12 mb-3",children:[s.jsx("label",{className:"form-label",children:"Tipo de Envío"}),s.jsxs("div",{className:"row",children:[s.jsx(V,{eRef:m,label:"¿Delivery gratis?",col:"col-6",onChange:e=>{D(e.target.checked),e.target.checked?(S(!1),f.current.checked=!1,p("El envío gratis tiene costo 0. Puede agregar un costo adicional para delivery express.")):p("")},checked:d,refreshable:[d]}),s.jsx(V,{eRef:f,label:"¿Recojo en agencia?",col:"col-6",onChange:e=>{S(e.target.checked),e.target.checked?(D(!1),m.current.checked=!1,p("Este es un envío que se realizará por empresas de envío como Shalom, Olva Currier u otros, el cliente realizara el pago en destino.")):p("")},checked:v,refreshable:[v]})]}),O&&s.jsx("div",{className:"alert alert-info mt-2",children:O})]}),s.jsx("div",{className:"col-12",hidden:d||v,children:s.jsx(x,{eRef:C,label:"Costo de envío",col:"col-12",type:"number",step:.01,required:!0})}),s.jsx("div",{className:"col-12",hidden:!d,children:s.jsx(x,{eRef:T,label:"Costo de envío Express",col:"col-12",type:"number",step:.01,required:!0})}),s.jsx("div",{className:"col-12",hidden:!v,children:s.jsx(x,{eRef:E,label:"Costo de envío a Agencia",col:"col-12",type:"number",step:.01,required:!0})}),s.jsx(de,{eRef:N,label:"Descripción",rows:2})]})]}),s.jsx(I,{modalRef:z,title:"Tipos de Delivery",size:"lg",children:s.jsx(J,{gridRef:l,title:"Tipos de Delivery",rest:K,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(l.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre",width:"150px",allowExporting:!1},{dataField:"description",caption:"Descripción",width:"300px",cellTemplate:(e,{data:r})=>{e.html(r.description||'<i class="text-muted">- Sin descripción -</i>')}},{dataField:"characteristics",caption:"Caracteristicas",width:"200px",cellTemplate:(e,{data:r})=>{r.characteristics&&r.characteristics.forEach(n=>{e.css("text-overflow","unset"),e.append(o.renderToString(s.jsx("li",{className:"d-flex gap-2",children:s.jsxs("i",{className:"text-muted font-italic d-block",children:["- ",n]})})))})}},{caption:"Acciones",width:"50px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(G({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>se(r)}))},allowFiltering:!1,allowExporting:!1}]})}),s.jsxs(I,{modalRef:R,title:q?"Editar tipo de Delivery":"Agregar tipo de Delivery",onSubmit:re,size:"sm",children:[s.jsx("input",{ref:k,type:"hidden"}),s.jsxs("div",{id:"form-container",className:"row",children:[s.jsxs("div",{className:"col-12",children:[s.jsx(x,{eRef:_,label:"Nombre",col:"col-12",type:"string"}),s.jsx(x,{eRef:F,label:"descripcion",col:"col-12",type:"string",required:!0})]}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Características"}),a.map((e,r)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Egresada de la Universidad Nacional Federico Villarreal.",value:e.value,onChange:n=>Y(r,n.target.value)}),s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>Z(r),disabled:a.length<=1,children:s.jsx("i",{className:"fas fa-times"})})]},r)),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:X,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})})]})]})]})};pe((c,t)=>{le.createRoot(c).render(s.jsx(me,{...t,title:"Costos de envio",children:s.jsx(xe,{...t})}))});
