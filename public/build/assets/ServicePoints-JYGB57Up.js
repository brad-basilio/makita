var xe=Object.defineProperty;var je=(c,m,d)=>m in c?xe(c,m,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[m]=d;var O=(c,m,d)=>je(c,typeof m!="symbol"?m+"":m,d);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as p}from"./index-BH53Isel.js";import{c as be}from"./ReactAppend-DTVVXReZ.js";import{L as Ne,G as ve,M as ye}from"./esm-hESa1MbP.js";import{B as Ce}from"./Base-BFPMzJYQ.js";import{C as we}from"./CreateReactScript-BoGwggCx.js";import{T as Se}from"./Table-DitbKwtZ.js";import{I as V}from"./InputFormGroup-D5I6zpZc.js";import{R as N}from"./ReactAppend-D7S498fx.js";import{D as z}from"./DxButton-DV0H-ZcL.js";import{S as q}from"./SwitchFormGroup-CGYpv_4Q.js";import{S as Re}from"./ProductCard-Ap6bpF1Q.js";import{B as _e}from"./BasicRest-B3rfI5GY.js";import"./server.browser-Bf4gQIc7.js";import{T as Be}from"./TextareaFormGroup-DVzYJtLM.js";import{M as Ee}from"./Modal-CIqmjseY.js";import{S as ke}from"./SelectFormGroup-YqB1XVb8.js";import{G as Te}from"./Global-ErywZRdd.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./index-rimy3MAc.js";import"./tippy-react.esm-BWiGTO87.js";/* empty css              */import"./Logout-7s5dsuEK.js";import"./main-BvVILmTO.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-C_dOKkRB.js";import"./index.esm-DAJ8Pwbk.js";import"./index-xsH4HHeE.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";import"./index-CMHsc23u.js";class $e extends _e{constructor(){super(...arguments);O(this,"path","admin/service-points")}}const v=new $e,Fe=({})=>{var G,H,L;const c=p.useRef(),m=p.useRef(),d=p.useRef(),R=p.useRef(),_=p.useRef(),B=p.useRef(),E=p.useRef(),[U,F]=p.useState(!1),[o,u]=p.useState([]),[x,y]=p.useState([""]),[j,C]=p.useState([""]),[b,w]=p.useState([{day:"Lun - Vie",hours:"08:00 - 20:00"}]),[g,k]=p.useState({lat:-12.0464,lng:-77.0428}),[h,S]=p.useState("main"),A=s=>{s!=null&&s.id?F(!0):F(!1),d.current.value=(s==null?void 0:s.id)??"",R.current.value=(s==null?void 0:s.type)??"distributor",_.current.value=(s==null?void 0:s.name)??"",B.current.value=(s==null?void 0:s.business_name)??"",E.current.value=(s==null?void 0:s.address)??"";const t=s!=null&&s.phones?s.phones.split(",").map(n=>n.trim()).filter(n=>n):[""];y(t.length>0?t:[""]);const a=s!=null&&s.emails?s.emails.split(",").map(n=>n.trim()).filter(n=>n):[""];C(a.length>0?a:[""]);const l=s!=null&&s.opening_hours?s.opening_hours.split(`
`).map(n=>{const r=n.split(":");return r.length>=2?{day:r[0].trim(),hours:r.slice(1).join(":").trim()}:{day:n.trim(),hours:""}}).filter(n=>n.day):[{day:"Lun - Vie",hours:"08:00 - 20:00"}];if(w(l.length>0?l:[{day:"Lun - Vie",hours:"08:00 - 20:00"}]),s!=null&&s.location){const n=s.location.split(",");if(n.length>=2){const r=parseFloat(n[0].trim()),f=parseFloat(n[1].trim());!isNaN(r)&&!isNaN(f)&&k({lat:r,lng:f})}}else k({lat:-12.0464,lng:-77.0428});const i=(s==null?void 0:s.branches)||[];u(i.map(n=>({name:n.name||"",address:n.address||"",phones:n.phones?n.phones.split(",").map(r=>r.trim()).filter(r=>r):[""],emails:n.emails?n.emails.split(",").map(r=>r.trim()).filter(r=>r):[""],opening_hours:n.opening_hours?n.opening_hours.split(`
`).map(r=>{const f=r.split(":");return f.length>=2?{day:f[0].trim(),hours:f.slice(1).join(":").trim()}:{day:r.trim(),hours:""}}).filter(r=>r.day):[{day:"Lun - Vie",hours:"08:00 - 20:00"}],location:n.location?(()=>{const r=n.location.split(",");if(r.length>=2){const f=parseFloat(r[0].trim()),M=parseFloat(r[1].trim());if(!isNaN(f)&&!isNaN(M))return{lat:f,lng:M}}return{lat:-12.0464,lng:-77.0428}})():{lat:-12.0464,lng:-77.0428}}))),S("main"),$(m.current).modal("show")},K=async s=>{s.preventDefault();const t={id:d.current.value||void 0,type:R.current.value,name:_.current.value,business_name:B.current.value,address:E.current.value,phones:x.filter(l=>l.trim()).join(", "),emails:j.filter(l=>l.trim()).join(", "),opening_hours:b.filter(l=>l.day&&l.hours).map(l=>`${l.day}: ${l.hours}`).join(`
`),location:`${g.lat}, ${g.lng}`,branches:o.length>0?o.map(l=>({name:l.name,address:l.address,phones:l.phones.filter(i=>i.trim()).join(", "),emails:l.emails.filter(i=>i.trim()).join(", "),opening_hours:l.opening_hours.filter(i=>i.day&&i.hours).map(i=>`${i.day}: ${i.hours}`).join(`
`),location:`${l.location.lat}, ${l.location.lng}`})):[],status:1,visible:1};await v.save(t)&&($(c.current).dxDataGrid("instance").refresh(),$(m.current).modal("hide"))},Y=async({id:s,value:t})=>{await v.boolean({id:s,field:"visible",value:t})&&$(c.current).dxDataGrid("instance").refresh()},J=async({id:s,value:t})=>{await v.boolean({id:s,field:"status",value:t})&&$(c.current).dxDataGrid("instance").refresh()},Q=async s=>{const{isConfirmed:t}=await Re.fire({title:"Eliminar punto de servicio",text:"¿Estás seguro de eliminar este punto de servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await v.delete(s)||$(c.current).dxDataGrid("instance").refresh()},W=s=>s==="distributor"?"Distribuidor":"Red de Servicio",X=s=>s==="distributor"?"badge-soft-primary":"badge-soft-success",Z=()=>{y([...x,""])},I=s=>{x.length>1&&y(x.filter((t,a)=>a!==s))},ee=(s,t)=>{const a=[...x];a[s]=t,y(a)},se=()=>{C([...j,""])},te=s=>{j.length>1&&C(j.filter((t,a)=>a!==s))},ae=(s,t)=>{const a=[...j];a[s]=t,C(a)},le=()=>{w([...b,{day:"",hours:""}])},ie=s=>{b.length>1&&w(b.filter((t,a)=>a!==s))},P=(s,t,a)=>{const l=[...b];l[s][t]=a,w(l)},ne=s=>{const t=s.latLng.lat(),a=s.latLng.lng();if(h==="main")k({lat:t,lng:a});else{const l=parseInt(h);!isNaN(l)&&o[l]&&T(l,"location",{lat:t,lng:a})}},oe=()=>{u([...o,{name:"",address:"",phones:[""],emails:[""],opening_hours:[{day:"Lun - Vie",hours:"08:00 - 20:00"}],location:{lat:-12.0464,lng:-77.0428}}])},re=s=>{u(o.filter((t,a)=>a!==s)),h===s.toString()&&S("main")},T=(s,t,a)=>{const l=o.map((i,n)=>n===s?{...i,[t]:a}:i);u(l)},ce=s=>{const t=[...o];t[s].phones.push(""),u(t)},me=(s,t)=>{const a=[...o];a[s].phones.length>1&&(a[s].phones=a[s].phones.filter((l,i)=>i!==t),u(a))},pe=(s,t,a)=>{const l=[...o];l[s].phones[t]=a,u(l)},de=s=>{const t=[...o];t[s].emails.push(""),u(t)},ue=(s,t)=>{const a=[...o];a[s].emails.length>1&&(a[s].emails=a[s].emails.filter((l,i)=>i!==t),u(a))},he=(s,t,a)=>{const l=[...o];l[s].emails[t]=a,u(l)},fe=s=>{const t=[...o];t[s].opening_hours.push({day:"",hours:""}),u(t)},ge=(s,t)=>{const a=[...o];a[s].opening_hours.length>1&&(a[s].opening_hours=a[s].opening_hours.filter((l,i)=>i!==t),u(a))},D=(s,t,a,l)=>{const i=[...o];i[s].opening_hours[t][a]=l,u(i)};return e.jsxs(e.Fragment,{children:[e.jsx(Se,{gridRef:c,title:"Puntos de Servicio",rest:v,toolBar:s=>{s.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(c.current).dxDataGrid("instance").refresh()}}),s.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo punto de servicio",hint:"Nuevo punto de servicio",onClick:()=>A()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"type",caption:"Tipo",width:"120px",cellTemplate:(s,{data:t})=>{N(s,e.jsx("span",{className:`badge ${X(t.type)}`,children:W(t.type)}))}},{dataField:"name",caption:"Información",width:"40%",cellTemplate:(s,{data:t})=>{N(s,e.jsxs("div",{children:[e.jsx("p",{className:"mb-1",children:e.jsx("strong",{children:t.name})}),t.business_name&&e.jsx("p",{className:"mb-1 text-muted small",children:t.business_name}),t.address&&e.jsxs("p",{className:"mb-0 text-muted small",children:[e.jsx("i",{className:"fa fa-map-marker-alt me-1"}),t.address]})]}))}},{dataField:"phones",caption:"Contacto",cellTemplate:(s,{data:t})=>{N(s,e.jsxs("div",{children:[t.phones&&e.jsxs("p",{className:"mb-1 small",children:[e.jsx("i",{className:"fa fa-phone me-1"}),t.phones]}),t.emails&&e.jsxs("p",{className:"mb-0 small",children:[e.jsx("i",{className:"fa fa-envelope me-1"}),t.emails]})]}))}},{dataField:"opening_hours",caption:"Horarios",cellTemplate:(s,{data:t})=>{N(s,t.opening_hours?e.jsx("small",{children:t.opening_hours}):e.jsx("i",{className:"text-muted",children:"No especificado"}))}},{dataField:"branches",caption:"Sucursales",width:"100px",allowFiltering:!1,cellTemplate:(s,{data:t})=>{const a=t.branches?t.branches.length:0;N(s,e.jsxs("span",{className:`badge ${a>0?"badge-soft-info":"badge-soft-secondary"}`,children:[a," sucursal",a!==1?"es":""]}))}},{dataField:"status",caption:"Activo",dataType:"boolean",width:"80px",cellTemplate:(s,{data:t})=>{N(s,e.jsx(q,{checked:t.status,onChange:a=>J({id:t.id,value:a.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(s,{data:t})=>{N(s,e.jsx(q,{checked:t.visible,onChange:a=>Y({id:t.id,value:a.target.checked})}))}},{caption:"Acciones",width:"120px",cellTemplate:(s,{data:t})=>{s.css("text-overflow","unset"),s.append(z({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>A(t)})),s.append(z({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>Q(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(Ee,{modalRef:m,title:U?"Editar punto de servicio":"Agregar punto de servicio",onSubmit:K,size:"xl",children:e.jsxs("div",{className:"row",id:"principal-container",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("input",{ref:d,type:"hidden"}),e.jsxs(ke,{eRef:R,label:"Tipo",col:"col-12",dropdownParent:"#principal-container",required:!0,children:[e.jsx("option",{value:"distributor",children:"Distribuidor"}),e.jsx("option",{value:"service_network",children:"Red de Servicio"})]}),e.jsx(V,{eRef:_,label:"Nombre",col:"col-12",required:!0}),e.jsx(V,{eRef:B,label:"Razón Social",col:"col-12"}),e.jsx(Be,{eRef:E,label:"Dirección",rows:2,col:"col-12"}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 mt-3",children:[e.jsx("label",{className:"form-label mb-0",children:"Teléfonos"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:Z,children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),x.map((s,t)=>e.jsxs("div",{className:"input-group mb-2",children:[e.jsx("input",{type:"text",className:"form-control",value:s,onChange:a=>ee(t,a.target.value),placeholder:`Teléfono ${t+1}`}),x.length>1&&e.jsx("div",{className:"input-group-append",children:e.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>I(t),title:"Eliminar teléfono",children:e.jsx("i",{className:"fa fa-trash"})})})]},t))]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"Emails"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:se,children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),j.map((s,t)=>e.jsxs("div",{className:"input-group mb-2",children:[e.jsx("input",{type:"email",className:"form-control",value:s,onChange:a=>ae(t,a.target.value),placeholder:`Email ${t+1}`}),j.length>1&&e.jsx("div",{className:"input-group-append",children:e.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>te(t),title:"Eliminar email",children:e.jsx("i",{className:"fa fa-trash"})})})]},t))]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"Horarios de Atención"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:le,children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),b.map((s,t)=>e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("input",{type:"text",className:"form-control",value:s.day,onChange:a=>P(t,"day",a.target.value),placeholder:"Ej: Lun - Vie"})}),e.jsx("div",{className:"col-md-6",children:e.jsx("input",{type:"text",className:"form-control",value:s.hours,onChange:a=>P(t,"hours",a.target.value),placeholder:"Ej: 08:00 - 20:00"})}),e.jsx("div",{className:"col-md-2",children:b.length>1&&e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>ie(t),title:"Eliminar horario",children:e.jsx("i",{className:"fa fa-trash"})})})]},t))]})}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 mt-4 p-3 bg-light rounded",children:[e.jsx("label",{className:"form-label mb-0 fw-bold",children:"Sucursales"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-soft-primary",onClick:oe,children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar Sucursal"]})]}),o.length===0&&e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"fa fa-info-circle me-2"}),'No hay sucursales agregadas. Haz clic en "Agregar Sucursal" para crear una.']}),o.map((s,t)=>e.jsxs("div",{className:"card mb-4 shadow-sm",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center bg-light",children:[e.jsxs("h6",{className:"mb-0 fw-bold text-primary",children:["Sucursal #",t+1]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-soft-danger",onClick:()=>re(t),title:"Eliminar sucursal",children:e.jsx("i",{className:"fa fa-trash"})})]}),e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Nombre"}),e.jsx("input",{type:"text",className:"form-control",value:s.name,onChange:a=>T(t,"name",a.target.value),placeholder:"Nombre de la sucursal"})]}),e.jsxs("div",{className:"col-md-12 mt-2",children:[e.jsx("label",{className:"form-label",children:"Dirección"}),e.jsx("input",{type:"text",className:"form-control",value:s.address,onChange:a=>T(t,"address",a.target.value),placeholder:"Dirección completa"})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 mt-3",children:[e.jsx("label",{className:"form-label mb-0",children:"Teléfonos"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>ce(t),children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),s.phones.map((a,l)=>e.jsxs("div",{className:"input-group mb-1",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",value:a,onChange:i=>pe(t,l,i.target.value),placeholder:`Teléfono ${l+1}`}),s.phones.length>1&&e.jsx("div",{className:"input-group-append",children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>me(t,l),title:"Eliminar teléfono",children:e.jsx("i",{className:"fa fa-trash"})})})]},l))]}),e.jsxs("div",{className:"col-md-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"Emails"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>de(t),children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),s.emails.map((a,l)=>e.jsxs("div",{className:"input-group mb-1",children:[e.jsx("input",{type:"email",className:"form-control form-control-sm",value:a,onChange:i=>he(t,l,i.target.value),placeholder:`Email ${l+1}`}),s.emails.length>1&&e.jsx("div",{className:"input-group-append",children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>ue(t,l),title:"Eliminar email",children:e.jsx("i",{className:"fa fa-trash"})})})]},l))]}),e.jsxs("div",{className:"col-md-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"Horarios de Atención"}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>fe(t),children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar"]})]}),s.opening_hours.map((a,l)=>e.jsxs("div",{className:"row mb-1",children:[e.jsx("div",{className:"col-5",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:a.day,onChange:i=>D(t,l,"day",i.target.value),placeholder:"Días"})}),e.jsx("div",{className:"col-5",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:a.hours,onChange:i=>D(t,l,"hours",i.target.value),placeholder:"Horario"})}),e.jsx("div",{className:"col-2",children:s.opening_hours.length>1&&e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>ge(t,l),title:"Eliminar horario",children:e.jsx("i",{className:"fa fa-trash"})})})]},l))]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Ubicación de la Sucursal"}),e.jsx("div",{className:"mb-2",children:e.jsxs("small",{className:"text-muted",children:["Coordenadas: ",s.location.lat.toFixed(6),", ",s.location.lng.toFixed(6)]})}),e.jsxs("small",{className:"text-muted",children:['Para cambiar la ubicación, selecciona "Sucursal ',t+1,'" en el mapa de la derecha']})]})]})})]},t))]})]}),e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ubicación en el Mapa"}),e.jsx("div",{className:"mb-2",children:e.jsx("small",{className:"text-muted",children:"Haz clic en el mapa para seleccionar la ubicación"})}),e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"nav nav-tabs mb-3 p-2 bg-light rounded",role:"tablist",style:{gap:"8px"},children:[e.jsxs("button",{type:"button",className:`nav-link ${h==="main"?"active":""} px-3 py-2`,onClick:()=>S("main"),style:{marginRight:"8px",borderRadius:"6px"},children:[e.jsx("i",{className:"fa fa-map-marker-alt me-1"}),"Ubicación Principal"]}),o.map((s,t)=>e.jsxs("button",{type:"button",className:`nav-link ${h===t.toString()?"active":""} px-3 py-2`,onClick:()=>S(t.toString()),style:{marginRight:"8px",borderRadius:"6px"},children:[e.jsx("i",{className:"fa fa-building me-1"}),"Sucursal ",t+1]},t))]})}),e.jsx(Ne,{googleMapsApiKey:Te.GMAPS_API_KEY,preventGoogleFontsLoading:!0,loadingElement:e.jsx("div",{children:"Cargando mapa..."}),children:e.jsx("div",{style:{height:"500px",width:"100%",marginTop:"15px",borderRadius:"8px",overflow:"hidden",border:"1px solid #e3e6f0"},children:e.jsx(ve,{mapContainerStyle:{width:"100%",height:"100%"},center:h==="main"?g:((G=o[parseInt(h)])==null?void 0:G.location)||g,zoom:15,onClick:ne,children:e.jsx(ye,{position:h==="main"?g:((H=o[parseInt(h)])==null?void 0:H.location)||g})})})}),e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-muted",children:["Coordenadas: ",h==="main"?`${g.lat.toFixed(6)}, ${g.lng.toFixed(6)}`:(L=o[parseInt(h)])!=null&&L.location?`${o[parseInt(h)].location.lat.toFixed(6)}, ${o[parseInt(h)].location.lng.toFixed(6)}`:"No seleccionada"]})})]})})})]})})]})};we((c,m)=>{let d=c._reactRoot;d||(d=be.createRoot(c),c._reactRoot=d),d.render(e.jsx(Ce,{...m,title:"Puntos de Servicio",children:e.jsx(Fe,{...m})}))});
