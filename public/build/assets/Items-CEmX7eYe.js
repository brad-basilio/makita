import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as ve}from"./Base-NNYOUAzC.js";import{S as D}from"./SwitchFormGroup-CGYpv_4Q.js";import{T as Re}from"./TextareaFormGroup-DVzYJtLM.js";import{r as n}from"./index-BH53Isel.js";import{c as we}from"./ReactAppend-DTVVXReZ.js";import{s as q}from"./server.browser-Bf4gQIc7.js";import{S as Ce}from"./ProductCard-C2H10lUi.js";import{I as se}from"./ItemsRest-Bz5T24RE.js";import{M as K}from"./Modal-CIqmjseY.js";import{T as Se}from"./Table-DitbKwtZ.js";import{I as J}from"./ImageFormGroup-BPR9pDAU.js";import{I as T}from"./InputFormGroup-D5I6zpZc.js";import{Q as Ne}from"./QuillFormGroup-D8zDHSfJ.js";import{S as Y}from"./SelectAPIFormGroup-LjjPmM2C.js";import{S as z}from"./SelectFormGroup-YqB1XVb8.js";import{D as Z}from"./DxButton-DV0H-ZcL.js";import{C as Fe}from"./CreateReactScript-B3e40jAW.js";import{N as ee}from"./Number2Currency-e57Tgsuk.js";import{R as N}from"./ReactAppend-D7S498fx.js";import{S as re}from"./SetSelectValue-UxyCmHse.js";import"./main-BSEyQEJW.js";import"./index-CMHsc23u.js";import"./index-yBjzXJbu.js";import"./Global-ErywZRdd.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-jUU_tfUq.js";import"./MenuItemContainer-BkmzVQNY.js";import"./index.esm-BE8-iLxT.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./BasicRest-CtWwZ3Gl.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";const te=({label:w,structure:d,value:j=[],onChange:x,typeOptions:S=[]})=>{const[m,f]=n.useState([]),g=n.useRef(!0);n.useEffect(()=>{if(g.current){const a=j.map(i=>{var u,l;return{...i,type:((u=i.type)==null?void 0:u.charAt(0).toUpperCase())+((l=i.type)==null?void 0:l.slice(1).toLowerCase())}});f(a),g.current=!1}else if(JSON.stringify(j)!==JSON.stringify(m)){const a=j.map(i=>{var u,l;return{...i,type:((u=i.type)==null?void 0:u.charAt(0).toUpperCase())+((l=i.type)==null?void 0:l.slice(1).toLowerCase())}});f(a)}},[j]);const C=()=>{const a=[...m,{...d}];f(a),x([...m,d])},b=a=>{const i=m.filter((u,l)=>l!==a);f(i),x(i)},y=(a,i,u)=>{const l=[...m];l[a][i]=i==="type"?u.charAt(0).toUpperCase()+u.slice(1).toLowerCase():u,f(l),x(l)};return r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:w}),m.map((a,i)=>{const u=m.length%2!==0&&i===m.length-1;return r.jsxs("div",{className:"row g-2 mb-2",children:[typeof a=="object"?Object.keys(d).map(l=>r.jsx("div",{className:u?"col-9":"col-6",children:l==="type"?r.jsxs("select",{className:"form-select",value:a[l]||"",onChange:c=>y(i,l,c.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar..."}),S.map(c=>r.jsx("option",{value:c,children:c},c))]}):r.jsx("input",{type:"text",className:"form-control",value:a[l]||"",onChange:c=>y(i,l,c.target.value),placeholder:l})},l)):r.jsx("div",{className:u?"col-9":"col-6",children:r.jsx("input",{type:"text",className:"form-control",value:a,onChange:l=>y(i,null,l.target.value),placeholder:"Característica"})}),r.jsx("div",{className:"col-3",children:r.jsx("button",{type:"button",className:"btn btn-danger w-100",onClick:()=>b(i),children:"X"})})]},i)}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:C,children:"+ Agregar"})]})},Ie=new se,De=({gridRef:w,modalRef:d})=>{const[j,x]=n.useState(null),[S,m]=n.useState(!1),[f,g]=n.useState(""),[C,b]=n.useState(!1),y=i=>{x(i.target.files[0])},a=async()=>{var u,l;if(!j){g("Por favor, selecciona un archivo."),b(!0);return}const i=new FormData;i.append("file",j),m(!0);try{const c=await Ie.importData(i);if(console.log(c),c.error){const F=Array.isArray(c.error)?c.error.join(`
`):c.error;g(`Error en la importación:
${F}`),b(!0)}else g(c.message),b(!1),$(w.current).dxDataGrid("instance").refresh(),d.current&&d.current.close()}catch(c){g("Error al importar: "+(((l=(u=c.response)==null?void 0:u.data)==null?void 0:l.error)||c.message)),b(!0)}m(!1)};return r.jsx("div",{className:"bg-white",children:r.jsxs("div",{className:"modal-content",children:[r.jsx("div",{children:r.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:y})}),r.jsx("button",{onClick:a,disabled:S,className:"btn btn-primary mt-2",type:"button",children:S?"Subiendo...":"Subir Archivo"}),f&&r.jsx("div",{className:`alert ${C?"alert-danger":"alert-success"} mt-2`,role:"alert",children:r.jsx("div",{className:"alert-message",children:f})})]})})},k=new se,Te=({categories:w,brands:d,collections:j})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[x,S]=n.useState([]),m=n.useRef(),f=n.useRef(),g=n.useRef(),C=n.useRef(),b=n.useRef(),y=n.useRef(),a=n.useRef(),i=n.useRef(),u=n.useRef(),l=n.useRef(),c=n.useRef(),F=n.useRef(),O=n.useRef(),E=n.useRef(),_=n.useRef(),B=n.useRef(),M=n.useRef(),P=n.useRef(),ne=n.useRef([]),oe=n.useRef([]),[ie,Q]=n.useState(!1),[le,ce]=n.useState(null),[ke,ae]=n.useState(null),[A,R]=n.useState([]),W=n.useRef(),ue=e=>{const s=Array.from(e.target.files).map(o=>({file:o,url:URL.createObjectURL(o)}));R(o=>[...o,...s])},me=e=>{e.preventDefault();const s=Array.from(e.dataTransfer.files).map(o=>({file:o,url:URL.createObjectURL(o)}));R(o=>[...o,...s])},pe=e=>{e.preventDefault()},fe=(e,t)=>{e.preventDefault(),A[t].id?R(o=>o.map((p,v)=>v===t?{...p,toDelete:!0}:p)):R(o=>o.filter((p,v)=>v!==t))};n.useEffect(()=>{if(x&&x.images){const e=x.images.map(t=>({id:t.id,url:`/storage/images/item_image/${t.url}`}));R(e)}},[x]);const H=e=>{var t,s;if(console.log("data total",e),S(e||null),e!=null&&e.id?Q(!0):Q(!1),g.current.value=(e==null?void 0:e.id)||"",$(C.current).val((e==null?void 0:e.category_id)||null).trigger("change"),$(b.current).val((e==null?void 0:e.collection_id)||null).trigger("change"),re(y.current,(t=e==null?void 0:e.subcategory)==null?void 0:t.id,(s=e==null?void 0:e.subcategory)==null?void 0:s.name),$(a.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),i.current.value=(e==null?void 0:e.name)||"",u.current.value=(e==null?void 0:e.color)||"",l.current.value=(e==null?void 0:e.summary)||"",c.current.value=(e==null?void 0:e.price)||0,F.current.value=(e==null?void 0:e.discount)||0,re(O.current,(e==null?void 0:e.tags)??[],"id","name"),E.current.value=null,_.current.value=null,E.image.src=`/storage/images/item/${(e==null?void 0:e.banner)??"undefined"}`,_.image.src=`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,B.image.src=`/storage/images/item/${(e==null?void 0:e.texture)??"undefined"}`,M.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const o=e.images.map(p=>({id:p.id,url:`/api/items/gallery/media/${p.url}`}));R(o)}else R([]);e!=null&&e.specifications?V(e.specifications.map(o=>({type:o.type,title:o.title,description:o.description}))):V([]),P.current.value=e==null?void 0:e.stock,$(f.current).modal("show")},de=async e=>{e.preventDefault();const t={id:g.current.value||void 0,category_id:C.current.value,collection_id:b.current.value||null,subcategory_id:y.current.value,brand_id:a.current.value,name:i.current.value,color:u.current.value,summary:l.current.value,price:c.current.value,discount:F.current.value,tags:$(O.current).val(),description:M.current.value,stock:P.current.value,specifications:JSON.stringify(L)},s=new FormData;for(const h in t)s.append(h,t[h]);s.append("features",JSON.stringify(xe)),s.append("specifications",JSON.stringify(L));const o=_.current.files[0];o&&s.append("image",o);const p=B.current.files[0];p&&s.append("texture",p);const v=E.current.files[0];v&&s.append("banner",v),A.forEach((h,X)=>{h.toDelete||(h.file?s.append(`gallery[${X}]`,h.file):s.append(`gallery_ids[${X}]`,h.id))});const I=A.filter(h=>h.toDelete).map(h=>parseInt(h.id,10));I.length>0&&s.append("deleted_images",JSON.stringify(I)),console.log(s),await k.save(s)&&($(m.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"),R([]))},ge=async({id:e,value:t})=>{await k.boolean({id:e,field:"visible",value:t})&&$(m.current).dxDataGrid("instance").refresh()},G=async({id:e,field:t,value:s})=>{await k.boolean({id:e,field:t,value:s})&&$(m.current).dxDataGrid("instance").refresh()},he=async e=>{const{isConfirmed:t}=await Ce.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await k.delete(e)||$(m.current).dxDataGrid("instance").refresh()},[xe,be]=n.useState([]),[L,V]=n.useState([]),je=["General","Principal"],[$e,Ee]=n.useState(!1),U=n.useRef(),ye=()=>{$(U.current).modal("show")};return r.jsxs(r.Fragment,{children:[r.jsx(Se,{gridRef:m,title:"Items",rest:k,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>H()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>ye()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var s,o,p;e.html(q.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block fst-italic text-muted",children:(s=t.collection)==null?void 0:s.name}),r.jsx("b",{className:"d-block",children:(o=t.category)==null?void 0:o.name}),r.jsx("small",{className:"text-muted",children:(p=t.subcategory)==null?void 0:p.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",minWidth:"300px",cellTemplate:(e,{data:t})=>{const o=((p,v)=>{if(!p)return"";const I=p.split(" ");return I.length>v?I.slice(0,v).join(" ")+"...":p})(t.summary,12);e.html(q.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{children:o})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(q.renderToString(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",ee(t.price)]}),r.jsxs("span",{children:["S/.",ee(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{N(e,r.jsx("img",{src:`/storage/images/item/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:s=>s.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const s=t.is_new===1||t.is_new==="1"||t.is_new===!0;N(e,r.jsx(D,{checked:s,onChange:o=>G({id:t.id,field:"is_new",value:o.target.checked?1:0})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const s=t.offering===1||t.offering==="1"||t.offering===!0;N(e,r.jsx(D,{checked:s,onChange:o=>G({id:t.id,field:"offering",value:o.target.checked?1:0})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const s=t.recommended===1||t.recommended==="1"||t.recommended===!0;N(e,r.jsx(D,{checked:s,onChange:o=>G({id:t.id,field:"recommended",value:o.target.checked?1:0})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const s=t.featured===1||t.featured==="1"||t.featured===!0;N(e,r.jsx(D,{checked:s,onChange:o=>G({id:t.id,field:"featured",value:o.target.checked?1:0})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{N(e,r.jsx(D,{checked:t.visible,onChange:s=>ge({id:t.id,value:s.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(Z({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>H(t)})),e.append(Z({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>he(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(K,{modalRef:f,title:ie?"Editar curso":"Agregar curso",onSubmit:de,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:g,type:"hidden"}),r.jsxs("div",{className:"col-md-3",children:[r.jsx(z,{eRef:C,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>ce(e.target.value),children:w.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(z,{eRef:b,label:"Colección",dropdownParent:"#principal-container",onChange:e=>ae(e.target.value),children:j.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(Y,{eRef:y,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",le],dropdownParent:"#principal-container"}),r.jsx(z,{eRef:a,label:"Marca",dropdownParent:"#principal-container",children:d.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(T,{label:"Stock",eRef:P,type:"number"}),r.jsx(T,{eRef:c,label:"Precio",type:"number",step:"0.01",required:!0}),r.jsx(T,{eRef:F,label:"Descuento",type:"number",step:"0.01"}),r.jsx(Y,{id:"tags",eRef:O,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),r.jsxs("div",{className:"col-md-4",children:[r.jsx(T,{eRef:i,label:"Nombre",required:!0}),r.jsx(T,{eRef:u,label:"Color",required:!0}),r.jsx(J,{eRef:B,label:"Imagen Textura",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsx(Re,{eRef:l,label:"Resumen",rows:3}),r.jsx(te,{ref:ne,label:"Características",structure:"",onChange:be}),r.jsx(te,{ref:oe,label:"Especificaciones",structure:{type:"",title:"",description:""},value:L,onChange:V,typeOptions:je})]}),r.jsx("div",{className:"col-md-5",children:r.jsxs("div",{className:"row",children:[r.jsx(J,{eRef:E,label:"Banner",aspect:2/1,col:"col-12"}),r.jsx(J,{eRef:_,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:W,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:ue}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>W.current.click(),onDrop:me,onDragOver:pe,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-6",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:A.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:s=>fe(s,t),children:"×"})]},t))})})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx(Ne,{eRef:M,label:"Descripcion"})]}),r.jsx(K,{modalRef:U,title:"Importar Datos",size:"sm",children:r.jsx(De,{gridRef:m,modalRef:U})})]})};Fe((w,d)=>{we.createRoot(w).render(r.jsx(ve,{...d,title:"Items",children:r.jsx(Te,{...d})}))});
